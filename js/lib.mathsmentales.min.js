"use strict";String.prototype.minusculesSansAccent=function(){for(var accent=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],noaccent=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],str=this,i=0;i<accent.length;i++)str=str.replace(accent[i],noaccent[i]);return str.toLowerCase()},Array.prototype.indexOfForArrays=function(search){var searchJson=JSON.stringify(search),arrJson;return this.map(JSON.stringify).indexOf(searchJson)},Array.prototype.removeValue=function(value){let index=this.indexOf(value);return index>-1&&(this.splice(index,1),!0)},Array.prototype.getKeys=function(){let table=[];for(let i=0,j=this.length;i<j;i++)table.push(i);return table},String.prototype.shuffle=function(){return this.split("").sort((function(a,b){return Math.random()<.5?1:-1})).join("")};var debug=function(){modeDebug&&console.log(arguments)},moisFR=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],joursFR=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],modeDebug=!0,utils={seed:"sample",security:300,addClass:function(elt,newClass){var n=0;newClass=newClass.split(",");for(let i=0;i<newClass.length;i++)-1==(" "+elt.className+" ").indexOf(" "+newClass[i]+" ")&&(elt.className+=" "+newClass[i],n++);return n},getRadioChecked:function(name){let radio=document.getElementsByName(name);for(let i=0,length=radio.length;i<length;i++)if(radio[i].checked)return radio[i].value;return!1},numberIfNumber:function(value){return String(Number(value))===value?Number(value):value},isEmpty:function(obj){var x;for(x in obj)return!1;return!0},removeClass:function(elt,className){if((" "+elt.className+" ").indexOf(" "+className+" ")>-1){var classes=elt.className.split(" "),newclasses="";for(let i=0;i<classes.length;i++)classes[i]!==className&&(newclasses+=" "+classes[i]);elt.className=newclasses.trim()}},changeTempoValue:function(value){document.getElementById("tempo-value").innerHTML=value+" s.",MM.editedActivity&&MM.editedActivity.setTempo(value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+(MM.selectedCart+1)+"-list li.active span")[0].innerHTML=value)},changeNbqValue:function(value){document.getElementById("nbq-value").innerHTML=value,MM.editedActivity&&MM.editedActivity.setNbq(value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+(MM.selectedCart+1)+"-list li.active span")[1].innerHTML=value)},checkValues:function(){utils.changeTempoValue(document.getElementById("tempo-slider").value),utils.changeNbqValue(document.getElementById("nbq-slider").value)},checkSecurity:()=>(utils.security--,!(utils.security<0)||(console.log("infinite loop"),!1)),initializeAlea:function(seed){utils.seed=seed,utils.alea=new Math.seedrandom(utils.seed)},aleaInt:function(min,max){let qty=1,avoid=[];utils.security=300;let nodouble=!1;for(let i=2;i<arguments.length;i++)String(Number(arguments[i]))===arguments[i]||"number"==typeof arguments[i]?qty=arguments[i]:"string"==typeof arguments[i]&&"^"==arguments[i][0]&&(avoid=arguments[i].substring(1).split(","),avoid.indexOf("&")>-1&&(nodouble=!0));if(min===max)return min;if(max<min&&([min,max]=[max,min]),qty>1){var integers=[];for(let i=0;i<qty;i++){let thisint=math.round(utils.alea()*(max-min))+min;if(avoid.indexOf(thisint)>-1||nodouble&&integers.indexOf(thisint)>-1){if(i--,!utils.checkSecurity())break}else if(integers.push(thisint),!utils.checkSecurity())break}return modeDebug&&console.log("AleaInt array : "+integers),integers}{let thisint;do{if(thisint=math.round(utils.alea()*(max-min))+min,!utils.checkSecurity())break}while(avoid.indexOf(thisint)>-1);return modeDebug&&console.log("AleaInt 1 int : "+thisint),thisint}},aleaFloat:function(min,max,precision){let qty=1,avoid=[],nodouble=!1;utils.security=300,modeDebug&&console.log(arguments);for(let i=3;i<arguments.length;i++)String(Number(arguments[i]))===arguments[i]||"number"==typeof arguments[i]?qty=arguments[i]:"string"==typeof arguments[i]&&"^"===arguments[i][0]&&(avoid=arguments[i].substring(1).split(",").map(Number),avoid.indexOf("&")>-1&&(nodouble=!0));if(max<min&&([min,max]=[max,min]),qty>1){let nb;var floats=[];for(let i=0;i<qty;i++)if(nb=math.round(utils.alea()*(max-min)+min,precision),avoid.indexOf(nb)>-1||nodouble&&integers.indexOf(thisint)>-1){if(i--,!utils.checkSecurity())break}else if(floats.push(nb),security<0)break;return modeDebug&&console.log(floats),floats}{let nb;do{if(nb=math.round(utils.alea()*(max-min)+min,precision),!utils.checkSecurity())break;modeDebug&&console.log(nb)}while(avoid.indexOf(nb)>-1);return nb}},signedNumber:function(nb){return 0===nb?"":nb>0?"+"+nb:nb},signIfOne:function(nb){return 1===nb?"":-1===nb?"-":nb},showTab:function(element){let tab,el;utils.resetAllTabs(),"string"==typeof element?(tab=element,el=document.querySelector("#header-menu a[href='#"+element+"']")):(el=element,tab=element.getAttribute("href").substr(1)),utils.addClass(el,"is-active"),document.getElementById(tab).style.display=""},resetAllTabs:function(){let tabsButtons=document.querySelectorAll("#header-menu .tabs-menu-link"),contents=document.querySelectorAll(".tabs-content-item");document.getElementById("tab-accueil").display="none",contents.forEach(element=>{element.style.display="none"}),utils.removeClass(document.getElementById("btnaccueil"),"is-active"),tabsButtons.forEach(element=>{utils.removeClass(element,"is-active")})},toDecimalFr:function(value){let parties=value.split("."),partieEntiere=parties[0],partieDecimale="";if(parties.length>1&&(partieDecimale=parties[1]),partieEntiere.length>3){let s=partieEntiere.length%3;partieEntiere=partieEntiere.substring(0,s)+"~"+partieEntiere.substring(s).match(/\d{3}/g).join("~")}if(partieDecimale.length>3){let nbgp=~~(partieDecimale.length/3);partieDecimale=partieDecimale.match(/\d{3}/g).join("~")+"~"+partieDecimale.substring(3*nbgp)}return partieDecimale.length&&(partieDecimale="{,}"+partieDecimale),debug(partieEntiere+partieDecimale),partieEntiere+partieDecimale},mathRender:function(){let contents;["tab-enonce","tab-corrige","activityOptions"].forEach(id=>{let content=document.getElementById(id).innerHTML;document.getElementById(id).innerHTML=content.replace(/\$\$([^$]*)\$\$/gi,'<span class="math">$1</span>')}),document.querySelectorAll(".slide").forEach(elt=>{elt.innerHTML=elt.innerHTML.replace(/\$\$([^$]*)\$\$/gi,'<span class="math">$1</span>')}),document.querySelectorAll(".math").forEach((function(item){var texTxt=item.innerHTML.replace(/\&amp\;/g,"&");let nbrgx=/(\d+\.*\d*)/g;texTxt=texTxt.replace(nbrgx,utils.toDecimalFr);try{katex.render(texTxt,item,{throwOnError:!1,errorColor:"#FFF",colorIsTextColor:!0}),utils.removeClass(item,"math")}catch(err){item.innerHTML="<span class='err'>"+err+" avec "+texTxt+"</span>"}}))},clone:someThing=>void 0!==someThing&&("object"==typeof someThing?JSON.parse(JSON.stringify(someThing)):someThing),sToMin(sec){let time="";return(sec=Number(sec))>3600&&(time+=~~(sec/3600)+" h ",sec%=3600),sec>60&&(time+=~~(sec/60)+" min ",sec%=60),time+sec},restoreArray(obj){let regex=/\([^\)\,]*\,[^\(\,]*\)/g;for(let i in obj)"string"==typeof obj[i]?obj[i].indexOf(",")>0&&!regex.test(obj[i])&&(obj[i]=obj[i].split(",").map(utils.numberIfNumber)):"object"==typeof obj[i]&&(obj[i]=this.restoreArray(obj[i]));return obj},unOuNombre:value=>(value=Number(value),Math.round(Math.random())?1:value)},math={premiers:[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999],round:function(nb,precision){return void 0===precision?Math.round(nb):Number(Math.round(Number(nb+"e"+precision))+"e"+-precision)},valeurParDefaut:function(valeur,precision){return void 0===precision?Math.floor(valeur):Number(Math.floor(Number(valeur+"e"+precision))+"e"+-precision)},valeurParExces:function(valeur,precision){return void 0===precision?Math.ceil(valeur):Number(Math.ceil(Number(valeur+"e"+precision))+"e"+-precision)},listeProduits:function(entier,max){let liste=[];void 0===max&&(max=10);for(let i=1,top=Math.floor(Math.sqrt(entier));i<=top;i++){let reste,quotient=~~(entier/i);0==entier%i&&i<=max&&quotient<=max&&liste.push(i+"\\times"+quotient)}return liste.join("; ")},listeDiviseurs:function(nb){let maxSearch=Math.floor(Math.sqrt(nb)),diviseurs=[],grandsdiviseurs=[];for(let i=1;i<=maxSearch;i++)nb%i==0&&(diviseurs.push(i),i!==nb/i&&grandsdiviseurs.unshift(nb/i));return diviseurs=diviseurs.concat(grandsdiviseurs),diviseurs.join("; ")},listeDiviseurs10:function(nb){let diviseurs=[2,3,5,9,10],liste=[];for(let i=0,len=diviseurs.length;i<len;i++){const div=diviseurs[i];nb%div==0&&liste.push(div)}return liste.length?liste.join("; "):"aucun des nombres"},unpower:function(value){let matches=value.match(/(\d*)\^(\d*)/g);if(matches)for(let i=0,l=matches.length;i<l;i+=2)value=value.replace(matches[i],math.powerToProduct(matches[i]));return value},powerToProduct(power){let nb=Number(power.substring(0,power.indexOf("^"))),puissance=Number(power.substring(power.indexOf("^")+1)),a=[];for(let i=0;i<puissance;i++)a.push(nb);return a.join("*")},toTex:string=>string.replace(/\*/g,"\\times"),estDivisiblePar(nb,par,type){let reponses={w:[" est divisible ","n'est pas divisible"],yn:["oui","non"]};return(nb=Number(nb))%(par=Number(par))==0?reponses[type][0]:reponses[type][1]},pgcd:function(a,b){return Algebrite.run("gcd("+a+","+b+")")},ppcm:function(a,b){return Algebrite.run("lcm("+a+","+b+")")},getHM(h,m,s){debug(arguments),void 0===s&&(s=0);var d=new Date(2010,1,1,Number(h),Number(m),Number(s));return d.getHours()+" h "+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())},getHMs(h,m,s){void 0===s&&(s=0);var d=new Date(2010,1,1,Number(h),Number(m),Number(s));return d.getHours()+" h "+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+" min "+(d.getSeconds()<10?"0"+d.getSeconds():d.getSeconds())+" s."},simplifyFracDec(n,d){for(;n%10==0&&d%10==0;)n/=10,d/=10;return"\\dfrac{"+n+"}{"+d+"}"}};window.onload=function(){let tabsButtons;MM.ascii2tex=new AsciiMathParser,MM.resetCarts(),document.querySelectorAll("#header-menu .tabs-menu-link").forEach(element=>{element.onclick=function(){utils.showTab(element)}}),document.getElementById("btnaccueil").onclick=function(element){console.log(element),utils.showTab(element.target)},utils.checkValues(),utils.initializeAlea(Date()),library.openContents(),MM.setDispositionEnonce(utils.getRadioChecked("Enonces"))};class cart{constructor(id){this.id=id,this.end="correction",this.introduction="countdown",this.activities=[],this.sortable=void 0,this.editedActivityId=-1,this.target=[id],this.nbq=0,this.time=0,this.title="Groupe "+(id+1)}export(){let activities={};for(let i=0,l=this.activities.length;i<l;i++)activities[i]=this.activities[i].export();return{y:"c",i:this.id,a:activities,t:this.title,c:this.target,e:this.end,r:this.introduction}}import(obj){this.id=obj.id,this.end=obj.e;for(let i=0,l=obj.a.length;i<l;i++)this.activities[i]=Activity.import();this.title=obj.t,this.introduction=obj.r,this.target=obj.c}setEndValue(value){this.end=value}setIntroduction(value){this.introduction=value}addActivity(obj){this.editedActivityId=-1;let temp=new activity(obj);this.activities.push(temp),this.display()}removeActivity(index){this.activities.splice(index,1),this.display()}exchange(oldIndex,newIndex){let indexes=this.activities.getKeys();console.log(indexes);let tempindexes=indexes[oldIndex],temp=this.activities[oldIndex];this.activities.splice(oldIndex,1),indexes.splice(oldIndex,1),this.activities.splice(newIndex,0,temp),indexes.splice(newIndex,0,tempindexes),this.editedActivityId=indexes.indexOf(this.editedActivityId),this.display()}display(){let dom=document.getElementById("cart"+this.id+"-list");dom.innerHTML="",this.time=0,this.nbq=0;for(let i=0,l=this.activities.length;i<l;i++){let li=document.createElement("li"),activity=this.activities[i];this.time+=Number(activity.tempo)*Number(activity.nbq),this.nbq+=Number(activity.nbq),li.innerHTML="<img src='img/editcart.png' align='left' onclick='MM.editActivity("+i+")' title='Editer l'activité'>"+activity.title+" | <span>"+activity.tempo+"</span> s. | <span>"+activity.nbq+"</span> questions",MM.carts[this.id].editedActivityId===i&&(li.className="active"),dom.appendChild(li)}let spans=document.querySelectorAll("#cart"+this.id+" div.totaux span");debug(spans),spans[0].innerHTML=utils.sToMin(this.time),spans[1].innerHTML=this.nbq,spans[2].innerHTML=this.target,this.sortable=new Sortable(dom,{animation:150,ghostClass:"ghost-movement",onEnd:function(evt){MM.carts[this.id].exchange(evt.oldIndex,evt.newIndex)}})}}class steps{constructor(obj){this.step=0,this.size=obj.size,this.container=obj.container}addSize(value){this.size+=value}display(){let ul=document.createElement("ul");ul.className="steps is-balanced has-gaps is-horizontal has-content-above has-content-centered";for(let i=0;i<this.size;i++){let li=document.createElement("li");li.className="steps-segment";let span=document.createElement("span");if(i===this.step){span.className="steps-marker is-hollow",li.appendChild(span);let div=document.createElement("div");div.className="steps-content",div.innerHTML=this.step+1,li.appendChild(div),li.className+=" is-active"}else{span.className="steps-marker",li.appendChild(span);let div=document.createElement("div");div.innerHTML="&nbsp;",div.className="steps-content",li.appendChild(div)}ul.appendChild(li)}if(this.container.hasChildNodes()){modeDebug&&console.log("Replace Steps",this.step,this.size);let node=this.container.childNodes[0];this.container.replaceChild(ul,node)}else modeDebug&&console.log("Insert Steps",this.step,this.size),this.container.appendChild(ul)}nextStep(){return this.step++,this.display(),!(this.step>=this.size)&&this.step}}class Figure{constructor(obj,id,target){this.type=obj.type,this.content=obj.content,this.boundingbox=obj.boundingbox,this.axis=obj.axis,this.grid=obj.grid,this.id=id,this.figure=void 0,this.create(target)}create(destination){if("chart"===this.type){let div=document.createElement("div"),canvas=document.createElement("canvas");canvas.id=this.id,div.appendChild(canvas),destination.appendChild(div)}else if("graph"===this.type){let div=document.createElement("div");div.id=this.id,div.className="jsxbox fig",destination.appendChild(div)}}display(){if("chart"===this.type){let target=document.getElementById(this.id);this.figure=new Chart(target,this.content)}else if("graph"===this.type)try{this.figure=JXG.JSXGraph.initBoard(this.id,{boundingbox:this.boundingbox,keepaspectratio:!0,showNavigation:!1,showCopyright:!1,registerEvents:!1,axis:this.axis,grid:this.grid});for(let i=0,len=this.content.length;i<len;i++){let type=this.content[i][0],commande=this.content[i][1],options=!1;if(void 0!==this.content[i][2]&&(options=this.content[i][2]),"functiongraph"===type){let formule=commande;options?this.figure.create("functiongraph",[function(x){return eval(formule)}],options):this.figure.create("functiongraph",[function(x){return eval(formule)}],{strokeWidth:2})}else"jessiescript"===type?this.figure.construct(commande):["text","point"].indexOf(type)>-1&&(options?this.figure.create(type,commande,options):this.figure.create(type,commande))}}catch(error){debug("Figure",error,this)}}}class timer{constructor(slideid){this.durations=[],this.durationId=0,this.startTime=0,this.endTime=0,this.timeLeft=0,this.percent=0,this.id=slideid,this.break=!1,this.timer=!1,this.ended=!1}getTimeLeft(){this.timeLeft=this.endTime-Date.now(),this.percent=Math.round(100-this.timeLeft/10/this.durations[this.durationId]),this.display(),this.timeLeft<=0&&(this.stop(),MM.nextSlide(this.id))}addDuration(value){this.durations.push(value)}start(id){if(this.stop(),this.ended)return!1;this.break=!1;let btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];btnPause.src="img/slider-pause.png",utils.removeClass(btnPause,"blink_me"),id>-1&&(this.timeLeft=1e3*this.durations[id],this.durationId=id),this.startTime=Date.now(),this.endTime=this.startTime+this.timeLeft,this.timer&&(clearInterval(this.timer),this.timer=!1),this.timer=setInterval(this.getTimeLeft.bind(this),50)}pause(){if(this.ended)return!1;if(this.break)return this.break=!1,this.start(),!1;{this.break=!0,this.stop();let btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];btnPause.src="img/slider-play.png",utils.addClass(btnPause,"blink_me")}}stop(){this.timer&&(clearInterval(this.timer),this.timer=!1)}end(){this.stop(),this.ended=!0,MM.messageEndSlide(this.id,this.durationId),setTimeout(MM.endSliders,3e3)}display(){document.querySelector("#slider"+this.id+" progress").value=this.percent}}var MM={content:void 0,introType:void 0,selectedCart:0,seed:"",editedActivity:void 0,slidersOrientation:"",carts:[],steps:[],timers:[],figs:{},slidersNumber:1,editActivity:function(index){MM.editedActivity=MM.carts[MM.selectedCart].activities[index],MM.setTempo(MM.editedActivity.tempo),MM.setNbq(MM.editedActivity.nbq),MM.carts[MM.selectedCart].editedActivityId=index,MM.carts[MM.selectedCart].display(),MM.editedActivity.display(),document.getElementById("addToCart").className="hidden",document.getElementById("removeFromCart").className=""},setTempo:function(value){document.getElementById("tempo-slider").value=value,document.getElementById("tempo-value").innerHTML=value+" s."},setNbq:function(value){document.getElementById("nbq-slider").value=value,document.getElementById("nbq-value").innerHTML=value},resetCarts:function(){let Cart=new cart(0);MM.carts=[Cart],MM.setMinimalDisposition(0),MM.steps=[],MM.timers=[],MM.figs={},MM.resetInterface()},resetInterface(){document.getElementById("divcarts").className="hidden",document.getElementById("phantom").className="",document.getElementById("divparams").className="col-2 row-3 colsx2"},showCartInterface(){document.getElementById("divcarts").className="row-4",document.getElementById("phantom").className="hidden",document.getElementById("divparams").className="row-3"},addCart:function(){let cartsNb=MM.carts.length+1;if(cartsNb>4)return!1;MM.carts[cartsNb-1]=new cart(cartsNb-1),MM.setMinimalDisposition(cartsNb-1);let button=document.createElement("button");button.value=cartsNb,button.className="tabs-menu-link",button.innerHTML='<img src="img/cart'+cartsNb+'.png">',button.id="button-cart"+cartsNb,button.onclick=function(elt){let value="";value="img"===elt.target.nodeName.toLowerCase()?elt.target.parentNode.value:elt.target.value,MM.showCart(value)};let addcart=document.getElementById("addcart"),cartsMenu=document.getElementById("cartsMenu"),lastButton=cartsMenu.removeChild(addcart);cartsMenu.appendChild(button).click(),cartsNb<4&&cartsMenu.appendChild(lastButton)},removeCart:function(index){if(!window.confirm("Vous êtes sur le point de supprimer ce panier.\nConfirmez-vous ?"))return!1;let buttonCartToremove=document.getElementById("button-cart"+MM.carts.length),cartsMenu=document.getElementById("cartsMenu");if(cartsMenu.removeChild(buttonCartToremove),!document.getElementById("addcart")){let buttonAddCart=document.createElement("button");buttonAddCart.id="addcart",buttonAddCart.innerHTML='<img src="img/cartadd.png">',buttonAddCart.onclick=function(){MM.addCart()},cartsMenu.appendChild(buttonAddCart)}MM.carts.splice(index-1,1),MM.setMinimalDisposition(MM.carts.length-1),MM.showCart(1)},showCart(index){index=Number(index),MM.selectedCart=index-1;for(let i=1,nb=MM.carts.length,btn;i<=4;i++){i<=nb&&(btn=document.getElementById("button-cart"+i));let div=document.getElementById("cart"+(i-1));i!==index?(div.className="hidden",i<=nb&&utils.removeClass(btn,"is-active")):(div.className="cartcontent",i<=nb&&utils.addClass(btn,"is-active"))}MM.carts[MM.selectedCart].editedActivityId>-1&&MM.carts[MM.selectedCart].activities[MM.carts[MM.selectedCart].editedActivityId].display()},emptyCart(index){if(!window.confirm("Vous êtes sur le point de vider ce panier.\nConfirmez-vous ?"))return!1;MM.carts[index-1].activities=[],MM.carts[index-1].editedActivityId=-1,document.getElementById("cart"+index+"-list").innerHTML="",MM.carts[index-1].display()},addToCart(){MM.carts[MM.selectedCart].addActivity(MM.editedActivity),MM.showCartInterface()},removeFromCart(){let cart=MM.carts[MM.selectedCart];cart.removeActivity(cart.editedActivityId),cart.editedActivityId=-1,document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden"},populateQuestionsAndAnswers:function(){MM.figs={},MM.steps=[],MM.timers=[];let length=MM.carts.length,enonces=document.getElementById("enonce-content"),corriges=document.getElementById("corrige-content");length>1&&(enonces.className="grid-"+length,corriges.className="grid-"+length),enonces.innerHTML="",corriges.innerHTML="",MM.seed=Date(),utils.initializeAlea(MM.seed);for(let i=0;i<length;i++)for(let kk=0;kk<MM.carts[i].target.length;kk++){let indiceSlide=0,slideNumber=MM.carts[i].target[kk]-1,slider=document.getElementById("slider"+slideNumber);document.querySelector("#slider"+slideNumber+" .slider-title").innerHTML=MM.carts[i].title,modeDebug&&console.log(slider);let sliderSteps=document.querySelector("#slider"+slideNumber+" .steps-container"),dive=document.createElement("div"),divc=document.createElement("div"),h3e=document.createElement("h3"),h3c=document.createElement("h3");h3e.innerText=MM.carts[i].title,h3c.innerText=MM.carts[i].title,dive.append(h3e),divc.append(h3c);let ole=document.createElement("ol"),olc=document.createElement("ol");MM.steps[slideNumber]=new steps({size:0,container:sliderSteps}),MM.timers[slideNumber]=new timer(slideNumber);for(let z=0,len=MM.carts[i].activities.length;z<len;z++){let element=MM.carts[i].activities[z];element.generate(),MM.steps[slideNumber].addSize(element.nbq);for(let j=0;j<element.questions.length;j++){let div=document.createElement("div");div.className="slide w3-animate-top",indiceSlide>0&&(div.className+=" hidden"),div.id="slide"+slideNumber+"-"+indiceSlide;let span=document.createElement("span"),spanAns=document.createElement("span");spanAns.className="answerInSlide hidden",MM.timers[slideNumber].addDuration(element.tempo);let lie=document.createElement("li"),lic=document.createElement("li");void 0!==element.type&&""!==element.type&&"latex"!==element.type||(lie.className="math",lic.className="math",span.className="math",spanAns.className+=" math");let question=element.questions[j],answer=element.answers[j];if(Array.isArray(element.questions[j])){let alea=utils.aleaInt(0,element.questions[j].length-1);question=element.questions[j][alea]}lie.innerHTML=question,span.innerHTML=question,spanAns.innerHTML=answer,div.appendChild(span),div.appendChild(spanAns),slider.appendChild(div),void 0!==element.figures[j]&&(MM.figs[slideNumber+"-"+indiceSlide]=new Figure(element.figures[j],"c"+slideNumber+"-"+indiceSlide,div)),ole.appendChild(lie),lic.innerHTML=answer,olc.appendChild(lic),indiceSlide++}}dive.append(ole),divc.append(olc),enonces.append(dive),corriges.append(divc),MM.steps[slideNumber].display()}utils.mathRender()},start:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.checkIntro(),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),"321"===MM.introType?(document.getElementById("countdown-container").className="",setTimeout((function(){document.getElementById("countdown-container").className="hidden",MM.showSlideShows(),MM.startTimers()}),3600)):"example"===MM.introType?(MM.showSampleQuestion(),MM.showSlideShows()):(MM.showSlideShows(),MM.startTimers())},checkIntro:function(){MM.introType=utils.getRadioChecked("beforeSlider")},startTimers:function(){modeDebug&&console.log("startTimers ",MM.timers);for(let i=0,k=MM.timers.length;i<k;i++)MM.timers[i].start(0)},showSampleQuestion:function(){let nb=MM.slidersNumber;MM.seed="sample"+Date(),utils.initializeAlea(MM.seed);let container=document.getElementById("slideshow");for(let i=0,len=MM.carts.length;i<len;i++)MM.carts[i].activities[0].generateSample();let divSample=document.createElement("div");divSample.id="sampleLayer",divSample.className="sample";for(let i=0;i<nb;i++){let div=document.createElement("div");div.id="sample"+i,div.className=1===nb?"slider-1":2===nb?"slider-2":"slider-34",div.innerHTML=`Exemple <div class="slider-nav">\n            <button title="Montrer la réponse" onclick="MM.showSampleAnswer(${i});"><img src="img/slider-solution.png" /></button>\n            <button title="Autre exemple" onclick="MM.newSample(${i});"><img src="img/newsample.png" /></button>\n            <button title="Démarrer le diaporama" onclick="MM.startSlideShow(${i});"><img src="img/fusee.png" /></button>\n            </div>`;let divContent=document.createElement("div");divContent.className="slide",divContent.id="sampleSlide"+i;let span=document.createElement("span");span.id="sample"+i+"-enonce";let spanAnswer=document.createElement("span");spanAnswer.id="sample"+i+"-corr",spanAnswer.className="hidden",divContent.appendChild(span),divContent.appendChild(spanAnswer),div.appendChild(divContent),divSample.appendChild(div)}container.appendChild(divSample);for(let i=0;i<MM.carts.length;i++)for(let y=0;y<MM.carts[i].target.length;y++){let sN=MM.carts[i].target[y]-1,act=MM.carts[i].activities[0];if(document.getElementById("sample"+sN+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+sN+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+sN+"-enonce").className="math",document.getElementById("sample"+sN+"-corr").className+=" math"),void 0!==act.sample.figure){let fig=new Figure(act.sample.figure,"sample-c"+sN,document.getElementById("sampleSlide"+sN));setTimeout((function(){fig.display()}),100)}}utils.mathRender()},showQuestions:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[href='#tab-enonce'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},showAnswers:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[href='#tab-corrige'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},createSlideShows:function(){let nb=MM.slidersNumber,container=document.getElementById("slideshow");container.innerHTML="","vertical"===MM.slidersOrientation?container.className="hidden vertical":container.className="hidden";for(let i=0;i<nb;i++){let div=document.createElement("div");div.id="slider"+i,div.className=1===nb?"slider-1":2===nb?"slider-2":"slider-34",div.innerHTML=`<div class="slider-nav">\n            <button title="Arrêter le diaporama" onclick="MM.timers[${i}].end()"><img src="img/slider-stop.png" /></button>\n            <button title="Mettre le diapo en pause" onclick="MM.timers[${i}].pause()"><img src="img/slider-pause.png" /></button>\n            <button title="Montrer la réponse" onclick="MM.showTheAnswer(${i});"><img src="img/slider-solution.png" /></button>\n            <button title="Passer la diapo" onclick="MM.nextSlide(${i});"><img src="img/slider-next.png" /></button>\n            </div>\n            <div class="slider-title"></div>\n            <div class="slider-chrono"><progress class="progress is-link is-large" value="0" max="100"></progress></div>\n            <div class="steps-container"></div>`,container.appendChild(div)}},showSlideShows:function(){utils.removeClass(document.getElementById("slideshow-container"),"hidden"),utils.addClass(document.getElementById("app-container"),"hidden"),utils.isEmpty(MM.figs)||MM.displayFirstFigs()},displayFirstFigs:function(){for(let i=0;i<4;i++)"object"==typeof MM.figs[i+"-0"]&&MM.figs[i+"-0"].display()},hideSlideshows:function(){utils.addClass(document.getElementById("slideshow-container"),"hidden"),utils.removeClass(document.getElementById("app-container"),"hidden");let whatToDo=utils.getRadioChecked("endOfSlideRadio");"correction"===whatToDo?utils.showTab("tab-corrige"):"list"===whatToDo&&utils.showTab("tab-enonce")},showTheAnswer(id){let answerToShow=document.querySelector("#slide"+id+"-"+MM.steps[id].step+" .answerInSlide");answerToShow.className.indexOf("hidden")>-1?(MM.timers[id].pause(),utils.removeClass(answerToShow,"hidden")):(utils.addClass(answerToShow,"hidden"),MM.timers[id].start())},showSampleAnswer(id){let answerToShow=document.getElementById("sample"+id+"-corr");answerToShow.className.indexOf("hidden")>-1?utils.removeClass(answerToShow,"hidden"):utils.addClass(answerToShow,"hidden")},newSample(id){for(let i=0,len=MM.carts.length;i<len;i++)if(MM.carts[i].target.indexOf(id+1)>-1){let act=MM.carts[i].activities[0];if(act.generateSample(),document.getElementById("sample"+id+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+id+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+id+"-enonce").className="math",document.getElementById("sample"+id+"-corr").className+=" math"),void 0!==act.sample.figure){let item=document.getElementById("sample-c"+id);item.parentNode.removeChild(item);let fig=new Figure(act.sample.figure,"sample-c"+id,document.getElementById("sampleSlide"+id));setTimeout((function(){fig.display()}),100)}utils.mathRender()}},removeSample(){let item=document.getElementById("sampleLayer");item.parentNode.removeChild(item)},startSlideShow(){MM.removeSample(),MM.startTimers()},nextSlide:function(id){let step=MM.steps[id].nextStep();if(!1===step)return MM.timers[id].end(),!1;MM.timers[id].start(step);let slidetoHide=document.querySelector("#slide"+id+"-"+(step-1)),slide=document.querySelector("#slide"+id+"-"+step);utils.addClass(slidetoHide,"hidden"),slide?(utils.removeClass(slide,"hidden"),void 0!==MM.figs[id+"-"+step]&&MM.figs[id+"-"+step].display()):console.log("Fin du slide")},messageEndSlide:function(id,nth){let sliderMessage;console.log(id,nth),document.querySelectorAll("#slider"+id+" .slide")[nth].innerHTML="<span>Fin du diaporama</span>"},endSliders:function(){let ended=!0;for(let i=0,l=MM.timers.length;i<l;i++)!1===MM.timers[i].ended&&(ended=!1);ended&&(MM.hideSlideshows(),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display()))},pauseAllSliders(){for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].pause()},stopAllSliders:function(){for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].end()},nextAllSliders:function(){for(let i=0,l=MM.steps.length;i<l;i++)MM.nextSlide(i)},setMinimalDisposition:function(index){let radios=document.querySelectorAll("input[name='Enonces']");for(let i=0,l=radios.length;i<l;i++)radios[i].disabled=i<index,i===index&&(radios[i].checked=!0,MM.setDispositionEnonce(index+1))},setDispositionEnonce:function(value){if(value=Number(value),MM.slidersNumber=value,1===value)document.getElementById("sddiv1").className="sddiv1",document.getElementById("sddiv2").className="hidden",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",document.getElementById("onlinechoice").className="",MM.setDispositionDoubleEnonce("h"),MM.carts[0].target=[1];else if(2===value){let directions;document.querySelectorAll("input[name='direction']")[0].checked?MM.setDispositionDoubleEnonce("h"):MM.setDispositionDoubleEnonce("v"),document.getElementById("sddiv1").className="sddiv2",document.getElementById("sddiv2").className="sddiv2",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("onlinechoice").className="hidden",value>MM.carts.length?MM.carts[0].target=[1,2]:(MM.carts[0].target=[1],MM.carts[1].target=[2])}else 3===value?(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34",document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("onlinechoice").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3])):4===value&&(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34",document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="sddiv34",document.getElementById("onlinechoice").className="hidden",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3,4]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3,4]):3===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3],MM.carts[2].target=[4]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3],MM.carts[3].target=[4]));for(let i=0,l=MM.carts.length;i<l;i++)modeDebug&&console.log("Targets cart "+i,MM.carts[i].target),MM.carts[i].display()},setDispositionDoubleEnonce:function(option){"h"===option?(MM.slidersOrientation="horizontal",document.getElementById("screen-division").className=""):(MM.slidersOrientation="vertical",document.getElementById("screen-division").className="vertical",document.querySelector("input[name='direction'][value='v']").checked=!0)}},library={open:function(json){let obj=new activity(json);MM.editedActivity=obj;var tab=document.querySelector("a[href$='parameters'].tabs-menu-link");utils.resetAllTabs(),utils.addClass(tab,"is-active"),document.getElementById("tab-parameters").style.display="",document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",obj.display()},load:function(url){let reader=new XMLHttpRequest;reader.onload=function(){let json=JSON.parse(reader.responseText);library.open(json)},reader.open("get","library/"+url,!1),reader.send()},openContents:function(){let reader=new XMLHttpRequest;reader.onload=function(){MM.content=JSON.parse(reader.responseText)},reader.open("get","library/content.json",!0),reader.send()},displayContent:function(level){void 0===MM.content&&console.log("Pas de bibliothèque");let niveau=MM.content[level],html="<h1>Niveau "+niveau.nom+"</h1>";for(let i in niveau.themes){let first=!0,theme=!1,htmlt=first?"<span>":"";htmlt+="<h2>"+niveau.themes[i].nom+"</h2>";for(let j in niveau.themes[i].chapitres){let chapitre=!1,htmlc=first?"":"<span>";if(htmlc+="<h3>"+niveau.themes[i].chapitres[j].nom+"</h3>",htmlc+="<ul>",niveau.themes[i].chapitres[j].exercices.length){theme=!0,chapitre=!0;for(let k=0,len=niveau.themes[i].chapitres[j].exercices.length;k<len;k++)htmlc+="<li onclick=\"library.load('"+niveau.themes[i].chapitres[j].exercices[k].url+"')\">"+niveau.themes[i].chapitres[j].exercices[k].title+"</li>"}else htmlc+="<li>Pas encore d'exercice</li>";htmlc+="</ul>",chapitre&&(htmlt+=htmlc+(first?"":"</span>"),!0===first&&(htmlt+="</span>",first=!1))}theme&&(html+=htmlt)}document.getElementById("tab-chercher").innerHTML=html,document.querySelector("#header-menu a[href='#tab-chercher']").click()}};class activity{constructor(obj){this.id=obj.id||obj.ID,this.type=obj.type,this.figure=obj.figure,this.title=obj.title,this.description=obj.description,this.vars=obj.vars,this.consts=obj.consts,this.options=utils.clone(obj.options)||void 0,this.questionPatterns=utils.clone(obj.questionPatterns)||obj.question,this.answerPatterns=utils.clone(obj.answerPatterns)||obj.answer,this.valuePatterns=utils.clone(obj.valuePatterns)||obj.value,this.questions=utils.clone(obj.questions)||[],this.answers=utils.clone(obj.answers)||[],this.values=utils.clone(obj.values)||[],this.figures=utils.clone(obj.figures)||[],this.examplesFigs={},this.chosenOptions=utils.clone(obj.chosenOptions)||[],this.chosenQuestions=utils.clone(obj.chosenQuestions)||{},this.chosenQuestionTypes=utils.clone(obj.chosenQuestionTypes)||[],this.tempo=utils.clone(obj.tempo)||Number(document.getElementById("tempo-slider").value),this.nbq=utils.clone(obj.nbq)||Number(document.getElementById("nbq-slider").value)}initialize(){this.questions=[],this.answers=[],this.values=[],this.figures=[],this.examplesFigs={}}setTempo(value){this.tempo=Number(value)}setNbq(value){this.nbq=Number(value)}export(){return{y:"a",i:this.id,o:this.chosenOptions,q:this.chosenQuestions,p:this.chosenQuestionTypes,t:this.tempo,n:this.nbq}}import(obj){let regexp,level,url="N"+/(\d*)/.exec(obj.i)+"/"+obj.i+".json";library.load(url),this.id=obj.i,this.chosenOptions=obj.o,this.chosenQuestionTypes=obj.p,this.chosenQuestions=obj.q,this.tempo=obj.t,this.nbq=obj.n}getOption(){return 0===this.chosenOptions.length&&this.options?utils.aleaInt(0,this.options.length-1):this.chosenOptions.length>0&&this.chosenOptions[utils.aleaInt(0,this.chosenOptions.length-1)]}setMath(content){return void 0===this.type||"latex"===this.type?'<span class="math">'+content+"</span>":content}display(){this.initialize(),document.getElementById("param-title-act").innerHTML=this.id,document.getElementById("activityTitle").innerHTML=this.title,this.description?document.getElementById("activityDescription").innerHTML=this.description:document.getElementById("activityDescription").innerHTML="";var examples=document.getElementById("activityOptions");if(examples.innerHTML="",utils.initializeAlea("sample"),void 0!==this.options&&this.options.length>0){let colors=[""," red"," orange"," blue"," green"," grey"];for(let i=0;i<this.options.length;i++){this.generate(1,i,!1);let p=document.createElement("span"),input=document.createElement("input");input.id="o"+i,input.type="checkbox",input.value=i,input.setAttribute("onclick","MM.editedActivity.setOption(this.value, this.checked);"),input.checked=this.chosenOptions.indexOf(i)>-1,input.className="checkbox"+colors[i%colors.length],p.appendChild(input),p.appendChild(document.createTextNode(" "+this.options[i].name+" :"));let ul=document.createElement("ul");if(Array.isArray(this.questions[0]))for(let jj=0;jj<this.questions[0].length;jj++){let li=document.createElement("li"),checked="";this.chosenQuestions[i]&&this.chosenQuestions[i].indexOf(jj)>-1&&(checked="checked"),li.innerHTML="<input class='checkbox"+colors[i%colors.length]+"' type='checkbox' id='o"+i+"-"+jj+"' value='"+i+"-"+jj+"' onclick='MM.editedActivity.setOption(this.value, this.checked);'"+checked+"> "+this.setMath(this.questions[0][jj]),ul.appendChild(li)}else{let li=document.createElement("li");li.innerHTML=this.setMath(this.questions[0]),this.figures[0]&&(this.examplesFigs[i]=new Figure(utils.clone(this.figures[0]),"fig-ex"+i,li)),ul.appendChild(li)}p.appendChild(ul),examples.appendChild(p)}}else{this.generate(1);let p=document.createElement("span"),ul=document.createElement("ul");if(Array.isArray(this.questions[0]))for(let jj=0;jj<this.questions[0].length;jj++){let li=document.createElement("li");li.innerHTML="<input type='checkbox' class='checkbox' value='"+jj+"' onclick='MM.editedActivity.setQuestionType(this.value, this.checked);' ><span class='math'>"+this.questions[0][jj]+"</span>",ul.appendChild(li)}else{let li=document.createElement("li");li.innerHTML=this.setMath(this.questions[0]),this.figures[0]&&(this.examplesFigs[0]=new Figure(utils.clone(this.figures[0]),"fig-ex0",li)),ul.appendChild(li)}p.appendChild(ul);let p1=document.createElement("p");p1.innerHTML=this.setMath(this.answers[0]),p.appendChild(p1),examples.appendChild(p)}utils.isEmpty(this.examplesFigs)||setTimeout((function(){for(let i in MM.editedActivity.examplesFigs)MM.editedActivity.examplesFigs[i].display()}),300),utils.mathRender()}getPattern(option){return this.chosenQuestionTypes.length>0?this.chosenQuestionTypes[utils.aleaInt(0,this.chosenQuestionTypes.length-1)]:!1!==option&&(Array.isArray(this.chosenQuestions[option])?0===this.chosenQuestions[option].length&&Array.isArray(this.options[option].question)?utils.aleaInt(0,this.options[option].question.length-1):this.chosenQuestions[option].length>0&&this.chosenQuestions[option][utils.aleaInt(0,this.chosenQuestions[option].length-1)]:(this.chosenQuestions[option]=[],!1))}setOption(value,check){var optionId,renderId;if(value.indexOf("-")>-1){let Ids=value.split("-");optionId=Number(Ids[0]),renderId=Number(Ids[1]),check?(document.getElementById("o"+optionId).checked=!0,this.chosenOptions.indexOf(optionId)<0&&this.chosenOptions.push(optionId),Array.isArray(this.chosenQuestions[optionId])?this.chosenQuestions[optionId].indexOf(renderId)<0&&this.chosenQuestions[optionId].push(renderId):this.chosenQuestions[optionId]=[renderId]):this.chosenQuestions[optionId].removeValue(renderId)&&0===this.chosenQuestions[optionId].length&&(this.chosenOptions.removeValue(optionId),document.getElementById("o"+optionId).checked=!1)}else if(optionId=Number(value),check){if(this.chosenOptions.indexOf(optionId)<0&&this.chosenOptions.push(optionId),this.chosenQuestions[optionId]=[],"object"==typeof this.options[optionId].question)for(let i=0;i<this.options[optionId].question.length;i++)this.chosenQuestions[optionId].push(i),document.getElementById("o"+optionId+"-"+i).checked=!0;else if(Array.isArray(this.questionPatterns))for(let i=0;i<this.questionPatterns.length;i++)this.chosenQuestions[optionId].push(i),document.getElementById("o"+optionId+"-"+i).checked=!0}else if(this.chosenOptions.removeValue(optionId))if("object"==typeof this.options[optionId].question){for(let i=0;i<this.options[optionId].question.length;i++)document.getElementById("o"+optionId+"-"+i).checked=!1;delete this.chosenQuestions[optionId]}else if(Array.isArray(this.questionPatterns)){for(let i=0;i<this.questionPatterns.length;i++)document.getElementById("o"+optionId+"-"+i).checked=!1;delete this.chosenQuestions[optionId]}}setQuestionType(value,check){modeDebug&&console.log(value,check);let questionId=Number(value);check?this.chosenQuestionTypes.indexOf(questionId)<0&&(modeDebug&&console.log("chosenQuestionTypes add "+questionId),this.chosenQuestionTypes.push(questionId)):(modeDebug&&console.log("chosenQuestionTypse remove "+questionId),this.chosenQuestionTypes.removeValue(questionId))}replaceVars(chaine,index){if("string"==typeof chaine){for(const c in this.wVars){let regex=new RegExp(":"+c,"g");chaine=chaine.replace(regex,"this.wVars['"+c+"']")}for(const c in this.cConsts){let regex=new RegExp(":"+c,"g");chaine=chaine.replace(regex,"this.cConsts['"+c+"']")}if(void 0!==index){let regex=new RegExp(":question","g");chaine="sample"===index?chaine.replace(regex,this.sample.question):chaine.replace(regex,this.questions[index])}let result=eval("`"+chaine.replace(/\\/g,"\\\\")+"`");return isNaN(result)?result:parseFloat(result)}return"object"==typeof chaine?(chaine=utils.restoreArray(JSON.parse(this.replaceVars(JSON.stringify(chaine)))),chaine):chaine}generate(n,opt,patt,sample){void 0===n&&(n=this.nbq);let option,pattern,lenQ=!1;this.wVars={};for(let i=0;i<n;i++){option=void 0===opt?this.getOption():opt,pattern=void 0===patt?this.getPattern(option):patt,debug("option choisie : "+option,"Pattern choisi : "+pattern),!1!==option?(void 0===this.options[option].vars?this.cVars=this.vars:this.cVars=this.options[option].vars,void 0===this.options[option].consts?this.cConsts=this.consts:this.cConsts=this.options[option].consts,!1!==pattern?void 0!==this.options[option].question?(this.cQuestion=this.options[option].question[pattern],lenQ=this.options[option].question.length):(this.cQuestion=this.questionPatterns[pattern],lenQ=this.questionPatterns.length):void 0===this.options[option].question?this.cQuestion=this.questionPatterns:this.cQuestion=this.options[option].question,void 0===this.options[option].answer?this.cAnswer=this.answerPatterns:this.cAnswer=this.options[option].answer,Array.isArray(this.cAnswer)&&lenQ&&(this.cAnswer.length===lenQ?this.cAnswer=this.cAnswer[pattern]:answer=this.cAnswer[utils.aleaInt(0,this.cAnswer.length-1)]),void 0===this.options[option].value?this.cValue=this.valuePatterns:this.cValue=this.options[option].value,void 0!==this.options[option].figure?this.cFigure=utils.clone(this.options[option].figure):void 0!==this.figure&&(this.cFigure=utils.clone(this.figure))):(this.cVars=this.vars,this.cConsts=this.consts,this.cQuestion=!1!==pattern?this.questionPatterns[pattern]:this.questionPatterns,this.cAnswer=this.answerPatterns,this.cValue=this.valuePatterns,void 0!==this.figure&&(this.cFigure=utils.clone(this.figure)));for(const name in this.cVars)if(this.wVars[name]=this.cVars[name],"string"==typeof this.wVars[name]&&this.wVars[name].indexOf("${")>-1&&(this.wVars[name]=this.replaceVars(this.wVars[name])),"object"==typeof this.wVars[name])this.wVars[name]=this.replaceVars(this.wVars[name][utils.aleaInt(0,this.wVars[name].length-1)]);else if("string"==typeof this.wVars[name]&&this.wVars[name].indexOf("_")>-1){var bornes=this.wVars[name].split("_");bornes[0].indexOf("d")>-1?this.wVars[name]=utils.aleaFloat(Number(bornes[0].substring(1)),Number(bornes[1]),Number(bornes[2]),bornes[3],bornes[4]):this.wVars[name]=utils.aleaInt(Number(bornes[0]),Number(bornes[1]),bornes[2],bornes[3])}void 0!==this.cConsts&&(this.cConsts=this.replaceVars(this.cConsts)),modeDebug&&console.log("wWars",utils.clone(this.wVars)),sample?(this.sample={question:this.replaceVars(this.cQuestion)},this.sample.answer=this.replaceVars(this.cAnswer,"sample"),void 0!==this.cFigure&&(this.sample.figure={type:this.cFigure.type,content:this.replaceVars(this.cFigure.content),boundingbox:this.cFigure.boundingbox,axis:this.cFigure.axis,grid:!!this.cFigure.grid})):(this.questions[i]=this.replaceVars(this.cQuestion),this.answers[i]=this.replaceVars(this.cAnswer,i),this.values[i]=this.replaceVars(this.cValue),void 0!==this.cFigure&&(this.figures[i]={type:this.cFigure.type,content:this.replaceVars(this.cFigure.content),boundingbox:this.cFigure.boundingbox,axis:this.cFigure.axis,grid:!!this.cFigure.grid}))}}generateSample(){let option=this.getOption();this.generate(1,option,this.getPattern(option),!0)}}