"use strict";import protos from"./mods/protos.js";import utils from"./mods/utils.js";import MM from"./mods/MM.js";import library from"./mods/library.js";import sound from"./mods/sound.js";import Zoom from"./mods/zoom.js";window.onload=function(){let scripturl=document.getElementById("mmscriptid").attributes.src.value;MM.version=scripturl.replace(/\|/g,"/").slice(scripturl.indexOf("?")+3);let listener=function(evt){MM.touched=!0,window.removeEventListener("touchstart",listener,!1)},tabsButtons;window.addEventListener("touchstart",listener,!1),MM.resetCarts(),document.querySelectorAll("#header-menu .tabs-menu-link").forEach(element=>{element.onclick=function(){utils.showTab(element)}}),document.getElementById("btnaccueil").onclick=function(element){utils.showTab(element.target)},utils.checkValues(),utils.initializeAlea(Date()),library.openContents(),sound.getPlayer(),document.getElementById("chooseParamType").value="paramsdiapo",MM.setDispositionEnonce(utils.getRadioChecked("Enonces")),window.localStorage&&localStorage.getItem("history")&&(document.querySelector("#tab-historique ol").innerHTML=localStorage.getItem("history").replace(/onclick="utils\.checkurl\(this.dataset\['url'\]\,false\,true\)"/gi,"")),MM.zoom=new Zoom("thezoom","#slideshow .slide"),document.querySelector("#slideshow-container header").appendChild(MM.zoom.createCursor());for(let i=0;i<4;i++){let leparent=document.getElementById("sddiv"+(i+1));MM.colorSelectors[i]=new Picker({parent:leparent,color:"#FFFFFF"}),MM.colorSelectors[i].onChange=function(color){leparent.style.background=color.rgbaString,MM.colors[i]=color.rgbaString}}document.querySelector("input[name='online'][value='no']").checked=!0;const lis=document.querySelectorAll("#nav-menu-niveaux li li");for(const li of lis)li.onclick=evt=>{library.displayContent(evt.target.dataset.niv,!0)};document.getElementById("addToCart").onclick=()=>{MM.addToCart()},document.getElementById("unlinkCart").onclick=()=>{MM.unlinkActivity()},document.getElementById("removeFromCart").onclick=()=>{MM.removeFromCart()},document.getElementById("tempo-slider").oninput=evt=>{utils.changeTempoValue(evt.target.value)},document.getElementById("tempo-slider").onchange=()=>{MM.carts[MM.selectedCart].display()},document.getElementById("nbq-slider").oninput=evt=>{utils.changeNbqValue(evt.target.value)},document.getElementById("nbq-slider").onchange=()=>{MM.carts[MM.selectedCart].display()},document.getElementById("radiodir1").onclick=()=>{MM.setDispositionDoubleEnonce("h")},document.getElementById("radiodir2").onclick=()=>{MM.setDispositionDoubleEnonce("v")},document.getElementById("radiobeforeslider1").onclick=evt=>{MM.setIntroType(evt.target.value)},document.getElementById("radiobeforeslider2").onclick=evt=>{MM.setIntroType(evt.target.value)},document.getElementById("radiobeforeslider3").onclick=evt=>{MM.setIntroType(evt.target.value)},document.getElementById("playerlist").oninput=evt=>{sound.select(evt.target.value)},document.getElementById("btncartclose1").onclick=()=>{MM.emptyCart(1)},document.getElementById("titlecart1").onblur=evt=>{MM.carts[0].title=evt.target.innerText},document.getElementById("imgordercart1").onclick=evt=>{MM.carts[0].changeOrder(evt.target)},document.getElementById("imgduplicatecart1").onclick=()=>{MM.carts[0].duplicate()},document.getElementById("btncartdelete2").onclick=()=>{MM.removeCart(2)},document.getElementById("btncartclose2").onclick=()=>{MM.emptyCart(2)},document.getElementById("titlecart2").onblur=evt=>{MM.carts[1].title=evt.target.innerText},document.getElementById("imgordercart2").onclick=evt=>{MM.carts[1].changeOrder(evt.target)},document.getElementById("imgduplicatecart2").onclick=()=>{MM.carts[1].duplicate()},document.getElementById("btncartdelete3").onclick=()=>{MM.removeCart(3)},document.getElementById("btncartclose3").onclick=()=>{MM.emptyCart(3)},document.getElementById("titlecart3").onblur=evt=>{MM.carts[2].title=evt.target.innerText},document.getElementById("imgordercart3").onclick=evt=>{MM.carts[2].changeOrder(evt.target)},document.getElementById("imgduplicatecart3").onclick=()=>{MM.carts[2].duplicate()},document.getElementById("btncartdelete4").onclick=()=>{MM.removeCart(4)},document.getElementById("btncartclose4").onclick=()=>{MM.emptyCart(4)},document.getElementById("titlecart4").onblur=evt=>{MM.carts[3].title=evt.target.innerText},document.getElementById("imgordercart4").onclick=evt=>{MM.carts[3].changeOrder(evt.target)},document.getElementById("radioonline1").onclick=evt=>{MM.setOnlineState(evt.target.value)},document.getElementById("radioonline2").onclick=evt=>{MM.setOnlineState(evt.target.value)},document.getElementById("radionbenonces1").onclick=()=>{MM.setDispositionEnonce(1)},document.getElementById("radionbenonces2").onclick=()=>{MM.setDispositionEnonce(2)},document.getElementById("radionbenonces3").onclick=()=>{MM.setDispositionEnonce(3)},document.getElementById("radionbenonces4").onclick=()=>{MM.setDispositionEnonce(4)},document.getElementById("radioftf1").onclick=()=>{MM.setFacetoFace("n")},document.getElementById("radioftf2").onclick=()=>{MM.setFacetoFace("y")},document.getElementById("radioendslider1").onclick=evt=>{MM.setEndType(evt.target.value)},document.getElementById("radioendslider2").onclick=evt=>{MM.setEndType(evt.target.value)},document.getElementById("radioendslider3").onclick=evt=>{MM.setEndType(evt.target.value)},document.getElementById("btnstart").onclick=()=>{MM.start()},document.getElementById("btnenonces").onclick=()=>{MM.showQuestions()},document.getElementById("btnreponses").onclick=()=>{MM.showAnswers()},document.getElementById("btnadresse").onclick=()=>{MM.copyURL()},document.getElementById("btncopytohistoric").onclick=()=>{MM.copyURLtoHistory()},document.getElementById("aleaInURL").onchange=()=>{utils.setSeed("checkSwitched")},document.getElementById("chooseParamType").onchange=evt=>{utils.showParameters(evt.target.value)},document.getElementById("btngeneratesheet").onclick=()=>{MM.createExercicesSheet()},document.getElementById("btn-ex-adresse").onclick=()=>{MM.copyURL("exosheet")},document.getElementById("btn-ex-copytohistoric").onclick=()=>{MM.copyURLtoHistory("exosheet")},document.getElementById("btngenerateexams").onclick=()=>{MM.createExamSheet()},document.getElementById("ceintcolsval").oninput=evt=>{document.getElementById("ceintcols").innerHTML=evt.target.value,utils.createCeintureTitres(evt.target.value)},document.getElementById("ceintrowsval").oninput=evt=>{document.getElementById("ceintrows").innerHTML=evt.target.value},document.getElementById("ceintqtyvalue").oninput=evt=>{document.getElementById("ceintqty").innerHTML=evt.target.value},document.getElementById("btngenerateceinture").onclick=()=>{MM.createCeintureSheet()},document.getElementById("canqtyvalue").oninput=evt=>{document.getElementById("canqty").innerHTML=evt.target.value},document.getElementById("btn-can-adresse").onclick=()=>{MM.copyURL("cansheet")},document.getElementById("btn-can-copytohistoric").onclick=()=>{MM.copyURLtoHistory("cansheet")},document.getElementById("btngenerateCAN").onclick=()=>{MM.createCourseAuxNombres()},document.getElementById("btngenerateFC").onclick=()=>{MM.createFlashCards()},document.getElementById("cardsNbValue").oninput=evt=>{document.getElementById("cardsNb").innerHTML=evt.target.value},document.getElementById("btngenerateWG").onclick=()=>{MM.createWhoGots()},document.getElementById("dominosNbValue").oninput=evt=>{document.getElementById("dominosNb").innerHTML=evt.target.value},document.getElementById("dominosDoublons").onclick=evt=>{let text=document.getElementById("dominosDoublonsText");evt.target.checked?text.innerHTML="Oui":text.innerHTML="Non"},document.getElementById("dominosDoublons").checked=!0,document.getElementById("btngenerateDominos").onclick=()=>{MM.createDominos()},document.getElementById("btn-duel-start").onclick=()=>{MM.duelLaunch()},document.getElementById("btn-duel-adresse").onclick=()=>{MM.copyURL("duel")},document.getElementById("btn-duel-copytohistoric").onclick=()=>{MM.copyURLtoHistory("duel")},document.getElementById("duelbackgroundselect").onchange=evt=>{document.getElementById("duelbg").style.backgroundImage="url('./library/illustrations/backgrounds/bg"+evt.target.value+".jpg')"},document.getElementById("duelbg").style.backgroundImage="url('./library/illustrations/backgrounds/bg"+utils.getSelectValue("duelbackgroundselect")+".jpg')",document.getElementById("btn-annotation2").addEventListener("click",evt=>{let target=utils.getTargetWithImageInside(evt);utils.annotate("divparams",target.id)}),document.getElementById("btn-shuffle").onclick=()=>{MM.editedActivity.display("sample")},document.getElementById("btn-annotation-enonce").onclick=evt=>{let target=utils.getTargetWithImageInside(evt);utils.annotate("enonce-content",target.id)},document.getElementById("enonce-content").onclick=evt=>{"in"===evt.target.dataset.what?MM.zooms[evt.target.dataset.zoom].plus():"out"===evt.target.dataset.what&&MM.zooms[evt.target.dataset.zoom].minus()},document.getElementById("corrige-content").onclick=evt=>{"in"===evt.target.dataset.what?MM.zooms[evt.target.dataset.zoom].plus():"out"===evt.target.dataset.what&&MM.zooms[evt.target.dataset.zoom].minus()},document.getElementById("slideshow").addEventListener("click",evt=>{let targetId=evt.target.id;"in"===evt.target.dataset.what?MM.zooms[evt.target.dataset.zoom].plus():"out"===evt.target.dataset.what&&MM.zooms[evt.target.dataset.zoom].minus(),"img"===evt.target.nodeName.toLowerCase()&&(targetId=evt.target.parentNode.id);for(let i=0;i<4;i++)switch(targetId){case"ButtonNextAct"+i:MM.newSample(i,!0);break;case"btn-sample-annotate"+i:utils.annotate("sampleSlide"+i,targetId);break;case"btn-sample-showanswer"+i:MM.showSampleAnswer(i);break;case"btn-newsample"+i:MM.newSample(i);break;case"btn-sample-start"+i:MM.startSlideShow(i);break;case"btn-timer-end"+i:MM.timers[i].end();break;case"btn-timer-pause"+i:MM.timers[i].pause();break;case"btn-show-answer"+i:MM.showTheAnswer(i);break;case"btn-next-slide"+i:MM.nextSlide(i)}}),document.querySelector("#tab-corrige aside").addEventListener("click",evt=>{let target=utils.getTargetWithImageInside(evt);switch(target.id){case"btn-annotation-corrige":utils.annotate("corrige-content",target.id);break;case"btn-restart-otherdata":utils.setSeed(utils.seedGenerator()),MM.start();break;case"btn-restart-samedata":MM.start()}}),document.querySelector("#tab-historique header").addEventListener("click",evt=>{switch(evt.target.id){case"btnemptyhist":MM.emptyHistory();break;case"btnSelectHist":MM.createSelectHistory();break;case"btnsupprselhist":MM.removeSelectionFromHistory()}}),document.querySelector("#slideshow-container header").onclick=evt=>{switch(evt.target.parentNode.id){case"stop-all":MM.stopAllSliders();break;case"pause-all":MM.pauseAllSliders();break;case"next-all":MM.nextAllSliders()}switch(evt.target.dataset.what){case"in":MM.zooms[evt.target.dataset.zoom].plus();break;case"out":MM.zooms[evt.target.dataset.zoom].minus()}},document.getElementById("searchinput").onkeyup=evt=>{library.displayContent(evt.target.value)},document.getElementById("btn-params-aleakey").onclick=()=>{document.getElementById("aleaKey").value=utils.seedGenerator()},document.querySelector("#tab-historique ol").addEventListener("click",evt=>{evt.target.innerHTML.indexOf("🛠 éditer")>-1?utils.checkURL(evt.target.dataset.url,!1,!0):evt.target.innerHTML.indexOf("❌ Supprimer")>-1&&MM.removeFromHistory(evt.target.parentNode)}),document.getElementById("corrige-content").addEventListener("click",evt=>{"Figure"===evt.target.innerHTML&&MM.memory[evt.target.dataset.id].toggle()}),document.getElementById("cart0-list").addEventListener("click",evt=>{void 0!==evt.target.dataset.actid&&MM.editActivity(evt.target.dataset.actid)}),document.getElementById("cart1-list").addEventListener("click",evt=>{void 0!==evt.target.dataset.actid&&MM.editActivity(evt.target.dataset.actid)}),document.getElementById("cart2-list").addEventListener("click",evt=>{void 0!==evt.target.dataset.actid&&MM.editActivity(evt.target.dataset.actid)}),document.getElementById("cart3-list").addEventListener("click",evt=>{void 0!==evt.target.dataset.actid&&MM.editActivity(evt.target.dataset.actid)}),document.getElementById("cartsMenu").addEventListener("click",evt=>{let target=utils.getTargetWithImageInside(evt);target.value?MM.showCart(target.value):"addcart"===target.id&&MM.addCart()}),document.getElementById("activityOptions").addEventListener("click",evt=>{"chckallopt"===evt.target.id?MM.editedActivity.setOption("all",evt.target.checked):0===evt.target.id.indexOf("o")&&MM.editedActivity.setOption(evt.target.value,evt.target.checked)})};