"use strict";String.prototype.minusculesSansAccent=function(){for(var accent=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],noaccent=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],str=this,i=0;i<accent.length;i++)str=str.replace(accent[i],noaccent[i]);return str.toLowerCase()},Array.prototype.indexOfForArrays=function(search){var searchJson=JSON.stringify(search),arrJson;return this.map(JSON.stringify).indexOf(searchJson)},Array.prototype.removeValue=function(value){let index=this.indexOf(value);return index>-1&&(this.splice(index,1),!0)},Array.prototype.getKeys=function(){let table=[];for(let i=0,j=this.length;i<j;i++)table.push(i);return table},String.prototype.shuffle=function(){return this.split("").sort((function(a,b){return Math.random()<.5?1:-1})).join("")};var debug=function(){modeDebug&&console.log(arguments)},moisFR=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],joursFR=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],modeDebug=!0,utils={baseURL:/^.*\//.exec(window.location.href),seed:"sample",security:300,create:function(type,props){const elt=document.createElement(type);for(const p in props)elt[p]=props[p];return elt},setHistory(pageName,params){let chaine="",first=!0;if(void 0!==params.u){let regexp=/\/(.*)\./;params.u=regexp.exec(params.u)[1]}for(const i in params)first?(first=!1,chaine+=i+"="+params[i]):chaine+="&"+i+"="+params[i];history.pushState({id:"Homepage"},pageName,utils.baseURL+"index.html?"+chaine)},checkURL:function(){const vars=utils.getUrlVars();if(void 0===vars.n||void 0!==vars.cd)if(void 0!==vars.u){let regexp,level=/(\d*|T)/.exec(vars.u)[0];library.load("N"+level+"/"+vars.u+".json")}else if(void 0!==vars.c){let json=JSON.parse(decodeURIComponent(vars.c));MM.resetCarts();for(const i in json)MM.carts[i]=new cart(i),MM.carts[i].import(json[i]);setTimeout(a=>{MM.start()},2e3)}else void 0!==vars.cd&&(MM.resetCarts(),MM.carts[0]=new cart(0),library.load(MM1toMM2[vars.cd].new));else library.displayContent(vars.n,!0)},getUrlVars:function(){var vars={},hash;if(location.href.indexOf("#")>0&&location.href.indexOf("?")<0){let idExo=location.href.substring(location.href.indexOf("#")+1,location.href.length);void 0!==MM1toMM2[idExo].new&&(vars.u=MM1toMM2[idExo].new)}for(var hashes=window.location.href.replace("|","/").slice(window.location.href.indexOf("?")+1).split("&"),len=hashes.length,i=0;i<len;i++)vars[(hash=hashes[i].split("="))[0]]=hash[1];return vars},seedGenerator:function(){let str="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",code="";for(let i=0;i<6;i++)code+=str[utils.aleaInt(0,str.length-1)];return code},setSeed(value){void 0!==value?MM.seed=value:""===document.getElementById("aleaKey").value?(MM.seed=utils.seedGenerator(),document.getElementById("aleaKey").value=MM.seed):MM.seed=document.getElementById("aleaKey").value,utils.initializeAlea(MM.seed)},addClass:function(elt,newClass){var n=0;newClass=newClass.split(",");for(let i=0;i<newClass.length;i++)-1==(" "+elt.className+" ").indexOf(" "+newClass[i]+" ")&&(elt.className+=" "+newClass[i],n++);return n},getRadioChecked:function(name){let radio=document.getElementsByName(name);for(let i=0,length=radio.length;i<length;i++)if(radio[i].checked)return radio[i].value;return!1},numberIfNumber:function(value){return String(Number(value))===value?Number(value):value},isEmpty:function(obj){var x;for(x in obj)return!1;return!0},shuffle:function(arr){return!!Array.isArray(arr)&&(arr.sort(()=>utils.alea()-.5),arr)},join:function(arr,str){return!!Array.isArray(arr)&&arr.join(str)},createTuiles(){const grille=document.getElementById("tab-accueil");for(const i in MM.content){if(void 0===MM.content[i].activitiesNumber||0===MM.content[i].activitiesNumber||"activitiesNumber"===i)continue;const elt=utils.create("article",{className:"tuile"}),titre=utils.create("h3",{innerHTML:MM.content[i].nom});elt.appendChild(titre);const nba=utils.create("div",{innerHTML:MM.content[i].activitiesNumber+" activités"});elt.onclick=()=>{library.displayContent(i,!0)},elt.appendChild(nba),grille.appendChild(elt)}},removeClass:function(elt,className){if((" "+elt.className+" ").indexOf(" "+className+" ")>-1){var classes=elt.className.split(" "),newclasses="";for(let i=0;i<classes.length;i++)classes[i]!==className&&(newclasses+=" "+classes[i]);elt.className=newclasses.trim()}},changeTempoValue:function(value){document.getElementById("tempo-value").innerHTML=value+" s.",MM.editedActivity&&MM.editedActivity.setTempo(value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+(MM.selectedCart+1)+"-list li.active span")[0].innerHTML=value)},changeNbqValue:function(value){document.getElementById("nbq-value").innerHTML=value,MM.editedActivity&&MM.editedActivity.setNbq(value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+(MM.selectedCart+1)+"-list li.active span")[1].innerHTML=value)},checkValues:function(){utils.changeTempoValue(document.getElementById("tempo-slider").value),utils.changeNbqValue(document.getElementById("nbq-slider").value)},checkSecurity:()=>(utils.security--,!(utils.security<0)||(console.log("infinite loop"),!1)),initializeAlea:function(seed){utils.alea=seed?new Math.seedrandom(seed):new Math.seedrandom(MM.seed)},aleaInt:function(min,max){let qty=1,avoid=[],arrayType=!1;utils.security=300;let nodouble=!1,notPrime=!1;for(let i=2;i<arguments.length;i++)String(Number(arguments[i]))===arguments[i]||"number"==typeof arguments[i]?(qty=arguments[i],arrayType=!0):"string"==typeof arguments[i]&&"^"==arguments[i][0]&&(avoid=arguments[i].substring(1).split(","),avoid.indexOf("&")>-1&&(nodouble=!0),avoid.indexOf("prime")>-1&&(notPrime=!0),avoid=avoid.map(Number));if(min===max)return min;if(max<min&&([min,max]=[max,min]),arrayType){var integers=[];for(let i=0;i<qty;i++){let thisint=math.round(utils.alea()*(max-min))+min;if(avoid.indexOf(thisint)>-1||nodouble&&integers.indexOf(thisint)>-1||notPrime&&math.premiers.indexOf(thisint)>-1){if(i--,!utils.checkSecurity())break}else if(integers.push(thisint),!utils.checkSecurity())break}return integers}{let thisint;do{if(thisint=math.round(utils.alea()*(max-min))+min,!utils.checkSecurity())break}while(avoid.indexOf(thisint)>-1||notPrime&&math.premiers.indexOf(thisint)>-1);return thisint}},aleaFloat:function(min,max,precision){let qty=1,avoid=[],nodouble=!1;utils.security=300;for(let i=3;i<arguments.length;i++)String(Number(arguments[i]))===arguments[i]||"number"==typeof arguments[i]?qty=arguments[i]:"string"==typeof arguments[i]&&"^"===arguments[i][0]&&(avoid=arguments[i].substring(1).split(","),avoid.indexOf("&")>-1&&(nodouble=!0),avoid=avoid.map(Number));if(max<min&&([min,max]=[max,min]),qty>1){let nb;var floats=[];for(let i=0;i<qty;i++)if(nb=math.round(utils.alea()*(max-min)+min,precision),avoid.indexOf(nb)>-1||nodouble&&floats.indexOf(nb)>-1){if(i--,!utils.checkSecurity())break}else if(floats.push(nb),!utils.checkSecurity())break;return floats}{let nb;do{if(nb=math.round(utils.alea()*(max-min)+min,precision),!utils.checkSecurity())break}while(avoid.indexOf(nb)>-1);return nb}},signedNumber:function(nb){return 0===nb?"":nb>0?"+"+nb:nb},signIfOne:function(nb){return 1===nb?"":-1===nb?"-":nb},signedNumberButOne:function(nb){return 0===nb?"":1===nb?"+":-1===nb?"-":nb>0?"+"+nb:nb},nP:function(nb){return"-"===String(nb)[0]?"("+nb+")":nb},showTab:function(element){let tab,el;utils.resetAllTabs(),"none"!==element&&("string"==typeof element?(tab=element,el=document.querySelector("#header-menu a[numero='#"+element+"']")):(el=element,tab=element.getAttribute("numero").substr(1)),utils.addClass(el,"is-active"),document.getElementById(tab).style.display="")},showParameters:function(id){let ids=["paramsdiapo","paramsexos","paramsinterro","paramsceinture","paramsflashcards","paramswhogots"];if(ids.indexOf(id)<0)return!1;for(let i=0,len=ids.length;i<len;i++)document.getElementById(ids[i]).className="hidden";document.getElementById(id).className=""},resetAllTabs:function(){let tabsButtons=document.querySelectorAll("#header-menu .tabs-menu-link"),contents=document.querySelectorAll(".tabs-content-item");document.getElementById("tab-accueil").display="none",contents.forEach(element=>{element.style.display="none"}),utils.removeClass(document.getElementById("btnaccueil"),"is-active"),tabsButtons.forEach(element=>{utils.removeClass(element,"is-active")})},toDecimalFr:function(value){let parties=value.split("."),partieEntiere=parties[0],partieDecimale="";if(parties.length>1&&(partieDecimale=parties[1]),partieEntiere.length>3){let s=partieEntiere.length%3;partieEntiere=partieEntiere.substring(0,s)+"~"+partieEntiere.substring(s).match(/\d{3}/g).join("~")}if(partieDecimale.length>3){let nbgp=~~(partieDecimale.length/3);partieDecimale=partieDecimale.match(/\d{3}/g).join("~")+"~"+partieDecimale.substring(3*nbgp)}return partieDecimale.length&&(partieDecimale="{,}"+partieDecimale),partieEntiere+partieDecimale},annotate:function(){void 0===MM.annotate?MM.annotate=new draw:(MM.annotate.destroy(),MM.annotate=void 0)},montant:function(billets,entier,tot){let valeursBillets=[5,10,20,50,100],min=1/0,total=0;for(let i=0,len=billets.length;i<len;i++)min>valeursBillets[billets[i]]&&(min=valeursBillets[billets[i]]),total+=valeursBillets[billets[i]];return tot?total:entier?utils.aleaInt(total-min+1,total):utils.aleaFloat(total-min+1,total,2)},listeBillets:function(billets){let valeursBillets=[5,10,20,50,100],lesbillets={5:0,10:0,20:0,50:0,100:0},txt="des billets : ";for(let i=0,len=billets.length;i<len;i++)lesbillets[valeursBillets[billets[i]]]++;for(let val in lesbillets)lesbillets[val]>1?txt+=lesbillets[val]+" de "+val+" €, ":lesbillets[val]>0&&(txt+=val+" €, ");return txt},mathRender:function(wtarget){let contents;if(["tab-enonce","tab-corrige","activityOptions"].forEach(id=>{let content=document.getElementById(id).innerHTML;document.getElementById(id).innerHTML=content.replace(/\$\$([^$]*)\$\$/gi,'<span class="math">$1</span>')}),document.querySelectorAll(".slide").forEach(elt=>{elt.innerHTML=elt.innerHTML.replace(/\$\$([^$]*)\$\$/gi,'<span class="math">$1</span>')}),void 0!==wtarget){let content=wtarget.document.getElementById("creator-content");content.innerHTML=content.innerHTML.replace(/\$\$([^$]*)\$\$/gi,'<span class="math">$1</span>'),content.querySelectorAll(".math").forEach((function(item){var texTxt=item.innerHTML.replace(/\&amp\;/g,"&");let nbrgx=/(\d+\.*\d*)/g;texTxt=texTxt.replace(nbrgx,utils.toDecimalFr);try{katex.render(texTxt,item,{throwOnError:!1,errorColor:"#FFF",colorIsTextColor:!0}),utils.removeClass(item,"math")}catch(err){item.innerHTML="<span class='err'>"+err+" avec "+texTxt+"</span>"}}))}document.querySelectorAll(".math").forEach((function(item){var texTxt=item.innerHTML.replace(/\&amp\;/g,"&");let nbrgx=/(\d+\.*\d*)/g;texTxt=texTxt.replace(nbrgx,utils.toDecimalFr);try{katex.render(texTxt,item,{throwOnError:!1,errorColor:"#FFF",colorIsTextColor:!0}),utils.removeClass(item,"math")}catch(err){item.innerHTML="<span class='err'>"+err+" avec "+texTxt+"</span>"}}))},clone:someThing=>void 0!==someThing&&("object"==typeof someThing?JSON.parse(JSON.stringify(someThing)):someThing),sToMin(sec){let time="";return(sec=Number(sec))>3600&&(time+=~~(sec/3600)+" h ",sec%=3600),sec>60&&(time+=~~(sec/60)+" min ",sec%=60),time+sec},toDigits(value,digits){let puissance=Number("1e"+digits)-1;for(;String(value).length<String(puissance).length;)value="0"+value;return value},unOuNombre:value=>(value=Number(value),Math.round(Math.random())?1:value)},math={premiers:[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999],round:function(nb,precision){if(void 0===precision)return Math.round(nb);if(precision<5)return Number(Math.round(Number(nb+"e"+precision))+"e"+-precision);{let z;return new Big(nb).round(precision).toFixed()}},valeurParDefaut:function(valeur,precision){return void 0===precision?Math.floor(valeur):Number(Math.floor(Number(valeur+"e"+precision))+"e"+-precision)},valeurParExces:function(valeur,precision){return void 0===precision?Math.ceil(valeur):Number(Math.ceil(Number(valeur+"e"+precision))+"e"+-precision)},listeProduits:function(entier,max){let liste=[];void 0===max&&(max=10);for(let i=1,top=Math.floor(Math.sqrt(entier));i<=top;i++){let reste,quotient=~~(entier/i);0==entier%i&&i<=max&&quotient<=max&&liste.push(i+"\\times"+quotient)}return liste.join("; ")},listeDiviseurs:function(nb,array){let maxSearch=Math.floor(Math.sqrt(nb)),diviseurs=[],grandsdiviseurs=[];for(let i=1;i<=maxSearch;i++)nb%i==0&&(diviseurs.push(i),i!==nb/i&&grandsdiviseurs.unshift(nb/i));return diviseurs=diviseurs.concat(grandsdiviseurs),!0===array?diviseurs:diviseurs.join("; ")},plusGrandDiviseur:function(nb){const liste=math.listeDiviseurs(nb,!0);return liste[liste.length-2]},plusGrandDiviseurPremier(nb){if(nb<2)return nb;let prime=0,indice=0;for(;math.premiers[indice]<=nb;)indice++,nb%math.premiers[indice]==0&&(prime=math.premiers[indice]);return prime},listeDiviseurs10:function(nb){let diviseurs=[2,3,5,9,10],liste=[];for(let i=0,len=diviseurs.length;i<len;i++){const div=diviseurs[i];nb%div==0&&liste.push(div)}return liste.length?liste.join("; "):"aucun des nombres"},nonDiviseur(nb){let unnondiviseur=0;do{unnondiviseur=utils.aleaInt(2,nb-1)}while(nb%unnondiviseur==0);return unnondiviseur},unDiviseur(nb){let diviseurs=math.listeDiviseurs(nb,!0);return diviseurs[utils.aleaInt(0,diviseurs.length-1)]},unpower:function(value){let matches=value.match(/(\d*)\^(\d*)/g);if(matches)for(let i=0,l=matches.length;i<l;i+=2)value=value.replace(matches[i],math.powerToProduct(matches[i]));return value},powerToProduct(power){let nb=Number(power.substring(0,power.indexOf("^"))),puissance=Number(power.substring(power.indexOf("^")+1)),a=[];for(let i=0;i<puissance;i++)a.push(nb);return a.join("*")},toTex:string=>string.replace(/\*/g,"\\times"),simplifieRacine(radicande){const factors=Algebrite.run("factor("+radicande+")").split("*");let outOfSquareR=1,inSquareR=1;for(let i=0;i<factors.length;++i){const elt=factors[i].split("^"),nb=elt[0],power=void 0===elt[1]?1:elt[1];outOfSquareR*=Math.pow(nb,Math.floor(power/2)),inSquareR*=Math.pow(nb,power%2)}return(outOfSquareR>1?outOfSquareR:"")+(inSquareR>1?"\\sqrt{"+inSquareR+"}":"")},estDivisiblePar(nb,par,type){let reponses={w:[" est divisible ","n'est pas divisible"],yn:["oui","non"]};return(nb=Number(nb))%(par=Number(par))==0?reponses[type][0]:reponses[type][1]},compare:(a,b)=>a<b?"\\lt":a>b?"\\gt":"=",pgcd:function(a,b){return Algebrite.run("gcd("+a+","+b+")")},ppcm:function(a,b){return Algebrite.run("lcm("+a+","+b+")")},inverse:function(expr,notex){let ret;return ret=void 0===notex||!1===notex?Algebrite.run("printlatex(1/("+expr+"))"):Algebrite.run("1/("+expr+")"),ret},calc:function(expr,notex){let ret;return ret=void 0===notex||!1===notex?Algebrite.run("printlatex("+expr+")"):Algebrite.run(expr),ret},getHM(h,m,s){void 0===s&&(s=0);var d=new Date(2010,1,1,Number(h),Number(m),Number(s));return d.getHours()+" h "+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())},getHMs(h,m,s){void 0===s&&(s=0);var d=new Date(2010,1,1,Number(h),Number(m),Number(s));return d.getHours()+" h "+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+" min "+(d.getSeconds()<10?"0"+d.getSeconds():d.getSeconds())+" s."},fractionSimplifiee(n,d){(n<0&&d<0||n>0&&d<0)&&(n=-n,d=-d);const gcd=math.pgcd(n,d);return Number.isInteger(n/d)?n/d:"\\dfrac{"+n/gcd+"}{"+d/gcd+"}"},simplifyFracDec(n,d){for(;n%10==0&&d%10==0;)n/=10,d/=10;return"\\dfrac{"+n+"}{"+d+"}"},phrase(operandes,operations,option,ordre){let x,y,r,z,phrases={"+":["la somme de ${x} et de ${y}","${x}+${y}","${x}+${y}"],"-":["la différence entre ${x} et ${y}","${x}-${y}","${x}-${y}"],"*":["le produit de ${x} par ${y}","${x}\\\\times ${y}","${x}*${y}"],"/":["le quotient de ${x} par ${y}","${x}\\\\div ${y}","${x}/${y}"],q:["le quotient de ${x} par ${y}","\\\\dfrac{${x}}{${y}}","${x}/${y}"]};switch(x=operandes[0],y=operandes[1],option){case"p":r=eval("`"+phrases[operations[0]][0]+"`");break;case"a":r=eval("`"+phrases[operations[0]][1]+"`");break;case"v":r=eval("`"+phrases[operations[0]][2]+"`")}if(operations.length>1)switch(ordre?(x=r,y=operandes[2],z=x,["*","/"].indexOf(operations[1])>-1&&["-","+"].indexOf(operations[0])>-1&&(z="("+x+")")):(x=operandes[2],y=r,z=y,(["*","/"].indexOf(operations[1])>-1&&["-","+"].indexOf(operations[0])>-1||"/"===operations[1])&&(z="("+y+")")),option){case"p":r=eval("`"+phrases[operations[1]][0]+"`").replace("de le","du");break;case"a":ordre?x=z:y=z,r=eval("`"+phrases[operations[1]][1]+"`");break;case"v":ordre?x=z:y=z,r=eval("`"+phrases[operations[1]][2]+"`")}return r},bigDecimal(a,op,b){let x=Big(a);return eval("x."+op+"("+b+").toString()")}};window.onload=function(){let tabsButtons;MM.ascii2tex=new AsciiMathParser,MM.resetCarts(),document.querySelectorAll("#header-menu .tabs-menu-link").forEach(element=>{element.onclick=function(){utils.showTab(element)}}),document.getElementById("btnaccueil").onclick=function(element){utils.showTab(element.target)},utils.checkValues(),utils.initializeAlea(Date()),library.openContents(),document.getElementById("chooseParamType").value="paramsdiapo",MM.setDispositionEnonce(utils.getRadioChecked("Enonces"));let reader=new XMLHttpRequest;reader.onload=function(){let json=JSON.parse(reader.responseText);window.scratchblocks.loadLanguages({fr:json})},reader.open("get","libs/scratchblocks/fr.json",!1),reader.send()};class cart{constructor(id){this.id=id,this.end="correction",this.introduction="countdown",this.activities=[],this.sortable=void 0,this.editedActivityId=-1,this.target=[id],this.nbq=0,this.time=0,this.title="Diapo "+(id+1)}export(){let activities={};for(let i=0,l=this.activities.length;i<l;i++)activities[i]=this.activities[i].export();return{y:"c",i:this.id,a:activities,t:this.title,c:this.target,e:this.end,r:this.introduction}}import(obj){this.id=obj.id,this.end=obj.e,this.title=obj.t,this.introduction=obj.r,this.target=obj.c;for(const i in obj.a)this.activities[i]=new activity({id:obj.a[i].i}),this.activities[i].import(obj.a[i])}setEndValue(value){this.end=value}setIntroduction(value){this.introduction=value}addActivity(obj){this.editedActivityId=-1;let temp=new activity(obj);this.activities.push(temp),this.display()}removeActivity(index){this.activities.splice(index,1),this.display()}exchange(oldIndex,newIndex){let indexes=this.activities.getKeys(),tempindexes=indexes[oldIndex],temp=this.activities[oldIndex];this.activities.splice(oldIndex,1),indexes.splice(oldIndex,1),this.activities.splice(newIndex,0,temp),indexes.splice(newIndex,0,tempindexes),this.editedActivityId=indexes.indexOf(this.editedActivityId),this.display()}display(){let dom=document.getElementById("cart"+this.id+"-list");dom.innerHTML="",this.time=0,this.nbq=0;for(let i=0,l=this.activities.length;i<l;i++){let li=document.createElement("li"),activity=this.activities[i];this.time+=Number(activity.tempo)*Number(activity.nbq),this.nbq+=Number(activity.nbq),li.innerHTML="<img src='img/editcart.png' align='left' onclick='MM.editActivity("+i+")' title='Editer l'activité'>"+activity.title+" | <span>"+activity.tempo+"</span> s. | <span>"+activity.nbq+"</span> questions",MM.carts[this.id].editedActivityId===i&&(li.className="active"),dom.appendChild(li)}let spans=document.querySelectorAll("#cart"+this.id+" div.totaux span");spans[0].innerHTML=utils.sToMin(this.time),spans[1].innerHTML=this.nbq,spans[2].innerHTML=this.target,this.sortable=new Sortable(dom,{animation:150,ghostClass:"ghost-movement",onEnd:function(evt){MM.carts[this.id].exchange(evt.oldIndex,evt.newIndex)}})}}class draw{constructor(){let c=utils.create("canvas",{id:"painting"});const target=document.getElementById("corrige-content");target.appendChild(c),this.canvas=document.getElementById("painting"),this.canvas.width=target.offsetWidth,this.canvas.height=target.offsetHeight+30,this.canvas.style.top=target.offsetTop,this.canvas.style.left=target.offsetLeft,this.mouse={x:0,y:0},this.canvas.addEventListener("mousemove",e=>{this.mouse.x=e.pageX-e.target.offsetLeft,this.mouse.y=e.pageY-e.target.offsetTop,this.enableDraw&&(this.started?(this.ctx.lineTo(this.mouse.x,this.mouse.y),this.ctx.stroke()):(this.started=!0,this.ctx.beginPath(),this.ctx.moveTo(this.mouse.x,this.mouse.y)))},!1),this.ctx=this.canvas.getContext("2d"),this.ctx.strokeStyle="blue",this.ctx.lineWidth=2,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.canvas.addEventListener("mousedown",e=>{this.enableDraw=!0},!1),this.canvas.addEventListener("mouseup",e=>{this.enableDraw=!1,this.started=!1},!1)}destroy(){this.canvas.parentNode.removeChild(this.canvas),this.canvas=void 0,this.ctx=void 0}}class steps{constructor(obj){this.step=0,this.size=obj.size,this.container=obj.container}addSize(value){this.size+=value}display(){let ul=document.createElement("ul");ul.className="steps is-balanced has-gaps is-horizontal has-content-above has-content-centered";for(let i=0;i<this.size;i++){let li=document.createElement("li");li.className="steps-segment";let span=document.createElement("span");if(i===this.step){span.className="steps-marker is-hollow",li.appendChild(span);let div=document.createElement("div");div.className="steps-content",div.innerHTML=this.step+1,li.appendChild(div),li.className+=" is-active"}else{span.className="steps-marker",li.appendChild(span);let div=document.createElement("div");div.innerHTML="&nbsp;",div.className="steps-content",li.appendChild(div)}ul.appendChild(li)}if(this.container.hasChildNodes()){let node=this.container.childNodes[0];this.container.replaceChild(ul,node)}else this.container.appendChild(ul)}nextStep(){return this.step++,this.display(),!(this.step>=this.size)&&this.step}}class Figure{constructor(obj,id,target,size){this.type=obj.type,this.content=obj.content,this.boundingbox=obj.boundingbox,this.axis=obj.axis,this.grid=obj.grid,this.id=id,this.size=size,this.figure=void 0,this.create(target)}create(destination){if("chart"===this.type){let div=document.createElement("div"),canvas=document.createElement("canvas");canvas.id=this.id,void 0!==this.size&&(div.style.width=this.size[0]+"px",div.style.height=this.size[1]+"px"),div.appendChild(canvas),destination.appendChild(div)}else if("graph"===this.type){let div=document.createElement("div");div.id=this.id,div.className="jsxbox fig",destination.appendChild(div)}}toggle(){let elt,cln;"chart"===this.type?elt=document.getElementById(this.id).parentNode:"graph"===this.type&&(elt=document.getElementById(this.id)),elt.className.indexOf("visible")<0?(utils.addClass(elt,"visible"),this.display()):utils.removeClass(elt,"visible")}display(destination){if("chart"===this.type){let target;target=void 0===destination?document.getElementById(this.id):destination.document.getElementById(this.id),this.figure=new Chart(target,this.content)}else if("graph"===this.type)try{this.figure=void 0===destination?JXG.JSXGraph.initBoard(this.id,{boundingbox:this.boundingbox,keepaspectratio:!0,showNavigation:!1,showCopyright:!1,registerEvents:!1,axis:this.axis,grid:this.grid}):destination.JXG.JSXGraph.initBoard(this.id,{boundingbox:this.boundingbox,keepaspectratio:!0,showNavigation:!1,showCopyright:!1,registerEvents:!1,axis:this.axis,grid:this.grid});for(let i=0,len=this.content.length;i<len;i++){let type=this.content[i][0],commande=this.content[i][1],options=!1;if(void 0!==this.content[i][2]&&(options=this.content[i][2]),"functiongraph"===type){let formule=commande;options?this.figure.create("functiongraph",[function(x){return eval(formule)}],options):this.figure.create("functiongraph",[function(x){return eval(formule)}],{strokeWidth:2})}else"jessiescript"===type?this.figure.construct(commande):["text","point","axis","line","segment"].indexOf(type)>-1&&(options?this.figure.create(type,commande,options):this.figure.create(type,commande))}}catch(error){debug("Figure",error,this)}}}class timer{constructor(slideid){this.durations=[],this.durationId=0,this.startTime=0,this.endTime=0,this.timeLeft=0,this.percent=0,this.id=slideid,this.break=!1,this.timer=!1,this.ended=!1}getTimeLeft(){this.timeLeft=this.endTime-Date.now(),this.percent=Math.round(100-this.timeLeft/10/this.durations[this.durationId]),this.display(),this.timeLeft<=0&&(this.stop(),MM.nextSlide(this.id))}addDuration(value){this.durations.push(value)}start(id){if(this.stop(),this.ended)return!1;this.break=!1;let btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];btnPause.src="img/slider-pause.png",utils.removeClass(btnPause,"blink_me"),id>-1&&(this.timeLeft=1e3*this.durations[id],this.durationId=id),this.startTime=Date.now(),this.endTime=this.startTime+this.timeLeft,this.timer&&(clearInterval(this.timer),this.timer=!1),this.timer=setInterval(this.getTimeLeft.bind(this),50)}pause(){if(this.ended)return!1;if(this.break)return this.break=!1,this.start(),!1;{this.break=!0,this.stop();let btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];btnPause.src="img/slider-play.png",utils.addClass(btnPause,"blink_me")}}stop(){this.timer&&(clearInterval(this.timer),this.timer=!1)}end(){this.stop(),this.ended=!0,MM.messageEndSlide(this.id,this.durationId),setTimeout(MM.endSliders,3e3)}display(){document.querySelector("#slider"+this.id+" progress").value=this.percent}}class ficheToPrint{constructor(type,cart){this.type=type,this.activities=cart.activities,this.wsheet=window.open("pagetoprint.html","mywindow","location=no,menubar=no,titlebar=no,width=794"),this.wsheet.onload=function(){MM.fiche.populate()}}generateQuestions(){utils.setSeed();for(let index=0;index<this.activities.length;index++){const activity=this.activities[index];activity.generate()}}populate(){this.wsheet.document.getElementsByTagName("html")[0].className="s"+document.getElementById("exTxtSizeValue").value.replace(".",""),this.content=this.wsheet.document.getElementById("creator-content"),this.docsheet=this.wsheet.document,this.generateQuestions(),"exo"===this.type?this.createExoSheet():"exam"===this.type?this.createInterroSheet():"ceinture"===this.type?this.createCeintureSheet():"flashcard"===this.type?this.createFlashCards():"whogots"===this.type&&this.createWhoGots(),utils.mathRender(this.wsheet),MM.editedActivity.display()}createElement(type){let elm=this.docsheet.createElement(type);return void 0!==arguments[1]&&(elm.className=arguments[1]),void 0!==arguments[2]&&(elm.innerHTML=arguments[2]),elm}createExoSheet(){let aleaCode=this.createElement("div","floatright","Clé : "+MM.seed);this.content.appendChild(aleaCode);let sheetTitle=document.getElementById("extitle").value||"Fiche d'exercices",header=this.createElement("header","",sheetTitle);this.content.appendChild(header);let exTitle=document.getElementById("exeachex").value||"Exercice n°",correction="end",radios=document.getElementsByName("excorr");for(let index=0;index<radios.length;index++)radios[index].checked&&(correction=radios[index].value);let correctionContent=this.createElement("div","correction"),titleCorrection=this.createElement("header","clearfix","Correction des exercices");"end"===correction&&correctionContent.appendChild(titleCorrection),MM.memory={};let divclear=this.createElement("div","clearfix");for(let i=0;i<this.activities.length;i++){const activity=this.activities[i];let sectionEnonce=this.createElement("section");sectionEnonce.id="enonce";let sectionCorrection=this.createElement("section"),h3=this.createElement("h3","exercice-title",exTitle+(i+1)+" : "+activity.title);sectionEnonce.appendChild(h3);let ol=this.createElement("ol"),olCorrection=this.createElement("ol","corrige");for(let j=0;j<activity.questions.length;j++){let li=this.createElement("li"),liCorrection=this.createElement("li");if("latex"===activity.type||""===activity.type||void 0===activity.type){let span=this.createElement("span","math",activity.questions[j]),spanCorrection=this.createElement("span","math",activity.answers[j]);li.appendChild(span),liCorrection.appendChild(spanCorrection)}else li.innerHTML=activity.questions[j],liCorrection.innerHTML=activity.answers[j];ol.appendChild(li),void 0!==activity.figures[j]&&(0===i&&0===j&&(MM.memory.dest=this.wsheet),MM.memory["f"+i+"-"+j]=new Figure(activity.figures[j],"f"+i+"-"+j,li)),olCorrection.appendChild(liCorrection)}sectionEnonce.appendChild(ol);let ds=divclear.cloneNode(!0);if(sectionEnonce.appendChild(ds),"end"!==correction){let hr=docsheet.createElement("hr");hr.style.width="50%",sectionEnonce.appendChild(hr),sectionEnonce.appendChild(olCorrection)}else{let h3correction=h3.cloneNode(!0);sectionCorrection.appendChild(h3correction),sectionCorrection.appendChild(olCorrection),correctionContent.appendChild(sectionCorrection)}this.content.appendChild(sectionEnonce)}if(correctionContent.hasChildNodes){this.content.appendChild(correctionContent);let ds=divclear.cloneNode(!0);this.content.appendChild(ds)}utils.isEmpty(MM.memory)||setTimeout((function(){for(const k in MM.memory)"dest"!==k&&MM.memory[k].display(MM.memory.dest)}),300)}createInterroSheet(){let aleaCode=this.createElement("div","floatright","Clé : "+MM.seed);this.content.appendChild(aleaCode);let sheetTitle=document.getElementById("inttitle").value||"Interrogation écrite",header=this.createElement("header","",sheetTitle);this.content.appendChild(header);let div1=this.createElement("div","studenName","Nom, prénom, classe :");this.content.appendChild(div1);let div2=this.createElement("div","remarques","Remarques :");this.content.appendChild(div2);let exTitle=document.getElementById("inteachex").value||"Exercice n°",correctionContent=this.createElement("div","correction"),titleCorrection=this.createElement("header","clearfix","Correction des exercices");correctionContent.appendChild(titleCorrection);let divclear=this.createElement("div","clearfix");for(let i=0;i<this.activities.length;i++){const activity=this.activities[i];let section=this.createElement("section"),sectionCorrection=this.createElement("section"),h3=this.createElement("h3","exercice-title",exTitle+(i+1)+" : "+activity.title);section.appendChild(h3);let ol=this.createElement("ol"),olCorrection=this.createElement("ol","corrige");for(let j=0;j<activity.questions.length;j++){let li=this.createElement("li","interro"),liCorrection=this.createElement("li");if("latex"===activity.type||""===activity.type||void 0===activity.type){let span=this.createElement("span","math",activity.questions[j]),spanCorrection=this.createElement("span","math",activity.answers[j]);li.appendChild(span),liCorrection.appendChild(spanCorrection)}else li.innerHTML=activity.questions[j],liCorrection.innerHTML=activity.answers[j];ol.appendChild(li),olCorrection.appendChild(liCorrection)}section.appendChild(ol);let ds=divclear.cloneNode(!0);section.appendChild(ds);let h3correction=h3.cloneNode(!0);sectionCorrection.appendChild(h3correction),sectionCorrection.appendChild(olCorrection),correctionContent.appendChild(sectionCorrection),this.content.appendChild(section)}this.content.appendChild(this.createElement("footer","","Fin")),this.content.appendChild(correctionContent);let ds=divclear.cloneNode(!0);this.content.appendChild(ds)}createFlashCards(){let aleaCode=this.createElement("div","floatright","Clé : "+MM.seed);this.content.appendChild(aleaCode);let sheetTitle=document.getElementById("FCtitle").value||"Interrogation écrite",header=this.createElement("header","",sheetTitle);this.content.appendChild(header)}createWhoGots(){}}var MM={content:void 0,introType:void 0,selectedCart:0,seed:"",editedActivity:void 0,slidersOrientation:"",onlineState:!1,carts:[],steps:[],timers:[],figs:{},userAnswers:[],slidersNumber:1,editActivity:function(index){MM.editedActivity=MM.carts[MM.selectedCart].activities[index],MM.setTempo(MM.editedActivity.tempo),MM.setNbq(MM.editedActivity.nbq),MM.carts[MM.selectedCart].editedActivityId=index,MM.carts[MM.selectedCart].display(),MM.editedActivity.display(),document.getElementById("addToCart").className="hidden",document.getElementById("removeFromCart").className=""},setTempo:function(value){document.getElementById("tempo-slider").value=value,document.getElementById("tempo-value").innerHTML=value+" s."},setNbq:function(value){document.getElementById("nbq-slider").value=value,document.getElementById("nbq-value").innerHTML=value},resetCarts:function(){let Cart=new cart(0);MM.carts=[Cart],MM.setMinimalDisposition(0),MM.steps=[],MM.timers=[],MM.figs={},MM.resetInterface()},resetInterface(){document.getElementById("divcarts").className="hidden",document.getElementById("phantom").className="",document.getElementById("divparams").className="col-2 row-3 colsx2"},showCartInterface(){document.getElementById("divcarts").className="row-4",document.getElementById("phantom").className="hidden",document.getElementById("divparams").className="row-3"},addCart:function(){let cartsNb=MM.carts.length+1;if(cartsNb>4)return!1;MM.carts[cartsNb-1]=new cart(cartsNb-1),MM.setMinimalDisposition(cartsNb-1);let button=document.createElement("button");button.value=cartsNb,button.className="tabs-menu-link",button.innerHTML='<img src="img/cart'+cartsNb+'.png">',button.id="button-cart"+cartsNb,button.onclick=function(elt){let value="";value="img"===elt.target.nodeName.toLowerCase()?elt.target.parentNode.value:elt.target.value,MM.showCart(value)};let addcart=document.getElementById("addcart"),cartsMenu=document.getElementById("cartsMenu"),lastButton=cartsMenu.removeChild(addcart);cartsMenu.appendChild(button).click(),cartsNb<4&&cartsMenu.appendChild(lastButton)},removeCart:function(index){if(!window.confirm("Vous êtes sur le point de supprimer ce panier.\nConfirmez-vous ?"))return!1;let buttonCartToremove=document.getElementById("button-cart"+MM.carts.length),cartsMenu=document.getElementById("cartsMenu");if(cartsMenu.removeChild(buttonCartToremove),!document.getElementById("addcart")){let buttonAddCart=document.createElement("button");buttonAddCart.id="addcart",buttonAddCart.innerHTML='<img src="img/cartadd.png">',buttonAddCart.onclick=function(){MM.addCart()},cartsMenu.appendChild(buttonAddCart)}MM.carts.splice(index-1,1),MM.setMinimalDisposition(MM.carts.length-1),MM.showCart(1)},showCart(index){index=Number(index),MM.selectedCart=index-1;for(let i=1,nb=MM.carts.length,btn;i<=4;i++){i<=nb&&(btn=document.getElementById("button-cart"+i));let div=document.getElementById("cart"+(i-1));i!==index?(div.className="hidden",i<=nb&&utils.removeClass(btn,"is-active")):(div.className="cartcontent",i<=nb&&utils.addClass(btn,"is-active"))}MM.carts[MM.selectedCart].editedActivityId>-1&&MM.carts[MM.selectedCart].activities[MM.carts[MM.selectedCart].editedActivityId].display()},emptyCart(index){if(!window.confirm("Vous êtes sur le point de vider ce panier.\nConfirmez-vous ?"))return!1;MM.carts[index-1].activities=[],MM.carts[index-1].editedActivityId=-1,document.getElementById("cart"+index+"-list").innerHTML="",MM.carts[index-1].display()},addToCart(){MM.carts[MM.selectedCart].addActivity(MM.editedActivity),MM.showCartInterface()},removeFromCart(){let cart=MM.carts[MM.selectedCart];cart.removeActivity(cart.editedActivityId),cart.editedActivityId=-1,document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden"},populateQuestionsAndAnswers:function(withAnswer){void 0===withAnswer&&(withAnswer=!0),MM.figs={},MM.steps=[],MM.timers=[],MM.memory={};let length=MM.carts.length,enonces=document.getElementById("enonce-content"),corriges=document.getElementById("corrige-content");length>1&&(enonces.className="grid-"+length,corriges.className="grid-"+length),enonces.innerHTML="",corriges.innerHTML="",utils.setSeed();for(let i=0;i<length;i++)for(let kk=0,clen=MM.carts[i].target.length;kk<clen;kk++){let indiceSlide=0,slideNumber=MM.carts[i].target[kk]-1,slider=document.getElementById("slider"+slideNumber),addTitle="";clen>1&&(addTitle="-"+(kk+1));let titleSlider=MM.carts[i].title+addTitle;document.querySelector("#slider"+slideNumber+" .slider-title").innerHTML=titleSlider;let sliderSteps=document.querySelector("#slider"+slideNumber+" .steps-container"),dive=document.createElement("div"),divc=document.createElement("div"),h3e=document.createElement("h3"),h3c=document.createElement("h3");h3e.innerText=titleSlider,h3c.innerText=titleSlider,dive.append(h3e),divc.append(h3c);let ole=document.createElement("ol"),olc=document.createElement("ol");MM.steps[slideNumber]=new steps({size:0,container:sliderSteps}),MM.timers[slideNumber]=new timer(slideNumber);for(let z=0,alen=MM.carts[i].activities.length;z<alen;z++){let element=MM.carts[i].activities[z];element.generate(),MM.steps[slideNumber].addSize(element.nbq);for(let j=0;j<element.questions.length;j++){let div=document.createElement("div");div.className="slide w3-animate-top",indiceSlide>0&&(div.className+=" hidden"),div.id="slide"+slideNumber+"-"+indiceSlide;let span=document.createElement("span"),spanAns=document.createElement("span");spanAns.className="answerInSlide hidden",MM.timers[slideNumber].addDuration(element.tempo);let lie=document.createElement("li"),lic=document.createElement("li");void 0!==element.type&&""!==element.type&&"latex"!==element.type||(lie.className="math",lic.className="math",span.className="math",spanAns.className+=" math");let question=element.questions[j],answer=element.answers[j];lie.innerHTML=question,span.innerHTML=question,spanAns.innerHTML=answer,div.appendChild(span),MM.onlineState||div.appendChild(spanAns),slider.appendChild(div),lic.innerHTML+=answer,void 0!==element.figures[j]&&(lic.innerHTML+="<button onclick=\"MM.memory['c"+slideNumber+"-"+indiceSlide+"'].toggle()\">Figure</button>",MM.figs[slideNumber+"-"+indiceSlide]=new Figure(element.figures[j],"c"+slideNumber+"-"+indiceSlide,div),MM.memory["e"+slideNumber+"-"+indiceSlide]=new Figure(element.figures[j],"en"+slideNumber+"-"+indiceSlide,lie,[300,150]),MM.memory["c"+slideNumber+"-"+indiceSlide]=new Figure(element.figures[j],"cor"+slideNumber+"-"+indiceSlide,lic,[450,225])),ole.appendChild(lie),olc.appendChild(lic),indiceSlide++}}dive.append(ole),divc.append(olc),enonces.append(dive),corriges.append(divc),MM.steps[slideNumber].display(),utils.isEmpty(MM.figs)||setTimeout((function(){for(let j=0;j<indiceSlide;j++)MM.memory["e"+slideNumber+"-"+j].display()}))}utils.mathRender(),MM.onlineState&&MM.createUserInputs()},createUserInputs:function(){let slider=0,slide=0;for(let i=0,len=MM.carts[0].activities.length;i<len;i++){let activity=MM.carts[0].activities[i];for(let j=0,lenq=activity.questions.length;j<lenq;j++){let element=document.getElementById("slide0-"+slide),span=document.createElement("span"),input=document.createElement("INPUT");input.type="text",input.id="userAnswer"+slide,input.dataset.id=j,input.className="inputUser",input.pattern="[dxsqrt/*+-^%]+",void 0!==activity.samples[j]?input.placeholder="ex. : "+activity.samples[j]:input.placeholder="Réponse ici",input.addEventListener("keyup",(function(event){"Enter"===event.key&&MM.nextSlide(0)})),span.appendChild(input),element.appendChild(span),slide++}}},createExercicesSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("exo",MM.carts[0])},createExamSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("exam",MM.carts[0])},createFlashCards:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("flashcard",MM.carts[0])},createWhoGots:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("whogots",MM.carts[0])},start:function(){if(MM.onlineState=MM.checkOnline(),MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.onlineState&&(MM.userAnswers=[],MM.carts.length>1))for(let i=1,len=MM.carts.length;i<len;i++)delete MM.carts[i];utils.showTab("none"),MM.checkIntro(),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),"321"===MM.introType?(document.getElementById("countdown-container").className="",setTimeout((function(){document.getElementById("countdown-container").className="hidden",MM.showSlideShows(),MM.startTimers()}),3600)):"example"===MM.introType?(MM.showSampleQuestion(),MM.showSlideShows()):(MM.showSlideShows(),MM.startTimers())},copyURL(){MM.checkOnline(),MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.checkIntro(),utils.setSeed();let carts={};for(let i=0;i<this.carts.length;i++)carts[i]=this.carts[i].export();utils.setHistory("Activité MathsMentales",{o:MM.onlineState,c:encodeURIComponent(JSON.stringify(carts))})},checkOnline:function(){let radios=document.getElementsByName("online"),ret=!1;for(let i=0;i<radios.length;i++)"yes"===radios[i].value&&radios[i].checked&&(ret=!0);return ret},checkIntro:function(){MM.introType=utils.getRadioChecked("beforeSlider")},startTimers:function(){for(let i=0,k=MM.timers.length;i<k;i++)MM.timers[i].start(0)},showSampleQuestion:function(){let nb=MM.slidersNumber;utils.setSeed("sample"+Date());let container=document.getElementById("slideshow");for(let i=0,len=MM.carts.length;i<len;i++)MM.carts[i].activities[0].generateSample();let divSample=document.createElement("div");divSample.id="sampleLayer",divSample.className="sample";for(let i=0;i<nb;i++){let div=document.createElement("div");div.id="sample"+i,div.className=1===nb?"slider-1":2===nb?"slider-2":"slider-34",div.innerHTML=`Exemple <div class="slider-nav">\n            <button title="Montrer la réponse" onclick="MM.showSampleAnswer(${i});"><img src="img/slider-solution.png" /></button>\n            <button title="Autre exemple" onclick="MM.newSample(${i});"><img src="img/newsample.png" /></button>\n            <button title="Démarrer le diaporama" onclick="MM.startSlideShow(${i});"><img src="img/fusee.png" /></button>\n            </div>`;let divContent=document.createElement("div");divContent.className="slide",divContent.id="sampleSlide"+i;let span=document.createElement("span");span.id="sample"+i+"-enonce";let spanAnswer=document.createElement("span");spanAnswer.id="sample"+i+"-corr",spanAnswer.className="hidden",divContent.appendChild(span),divContent.appendChild(spanAnswer),div.appendChild(divContent),divSample.appendChild(div)}container.appendChild(divSample);for(let i=0;i<MM.carts.length;i++)for(let y=0;y<MM.carts[i].target.length;y++){let sN=MM.carts[i].target[y]-1,act=MM.carts[i].activities[0];if(document.getElementById("sample"+sN+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+sN+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+sN+"-enonce").className="math",document.getElementById("sample"+sN+"-corr").className+=" math"),void 0!==act.sample.figure){let fig=new Figure(act.sample.figure,"sample-c"+sN,document.getElementById("sampleSlide"+sN));setTimeout((function(){fig.display()}),100)}}utils.mathRender()},showQuestions:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[numero='#tab-enonce'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},showAnswers:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[numero='#tab-corrige'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},createSlideShows:function(){let nb=MM.slidersNumber,container=document.getElementById("slideshow");container.innerHTML="","vertical"===MM.slidersOrientation?container.className="hidden vertical":container.className="hidden";for(let i=0;i<nb;i++){let div=document.createElement("div");div.id="slider"+i,div.className=1===nb?"slider-1":2===nb?"slider-2":"slider-34",div.innerHTML=`<div class="slider-nav">\n            <button title="Arrêter le diaporama" onclick="MM.timers[${i}].end()"><img src="img/slider-stop.png" /></button>\n            <button title="Mettre le diapo en pause" onclick="MM.timers[${i}].pause()"><img src="img/slider-pause.png" /></button>\n            <button title="Montrer la réponse" onclick="MM.showTheAnswer(${i});"><img src="img/slider-solution.png" /></button>\n            <button title="Passer la diapo" onclick="MM.nextSlide(${i});"><img src="img/slider-next.png" /></button>\n            </div>\n            <div class="slider-title"></div>\n            <div class="slider-chrono"><progress class="progress is-link is-large" value="0" max="100"></progress></div>\n            <div class="steps-container"></div>`,container.appendChild(div)}},showSlideShows:function(){utils.removeClass(document.getElementById("slideshow-container"),"hidden"),MM.onlineState&&document.getElementById("userAnswer0").focus(),utils.addClass(document.getElementById("app-container"),"hidden"),utils.isEmpty(MM.figs)||MM.displayFirstFigs()},displayFirstFigs:function(){for(let i=0;i<4;i++)"object"==typeof MM.figs[i+"-0"]&&MM.figs[i+"-0"].display()},hideSlideshows:function(){utils.addClass(document.getElementById("slideshow-container"),"hidden"),utils.removeClass(document.getElementById("app-container"),"hidden");let whatToDo=utils.getRadioChecked("endOfSlideRadio");"correction"===whatToDo?utils.showTab("tab-corrige"):"list"===whatToDo&&utils.showTab("tab-enonce")},showTheAnswer(id){let answerToShow=document.querySelector("#slide"+id+"-"+MM.steps[id].step+" .answerInSlide");answerToShow.className.indexOf("hidden")>-1?(MM.timers[id].pause(),utils.removeClass(answerToShow,"hidden")):(utils.addClass(answerToShow,"hidden"),MM.timers[id].start())},showSampleAnswer(id){let answerToShow=document.getElementById("sample"+id+"-corr");answerToShow.className.indexOf("hidden")>-1?utils.removeClass(answerToShow,"hidden"):utils.addClass(answerToShow,"hidden")},newSample(id){for(let i=0,len=MM.carts.length;i<len;i++)if(MM.carts[i].target.indexOf(id+1)>-1){let act=MM.carts[i].activities[0];if(act.generateSample(),document.getElementById("sample"+id+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+id+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+id+"-enonce").className="math",document.getElementById("sample"+id+"-corr").className+=" math"),void 0!==act.sample.figure){let item=document.getElementById("sample-c"+id);item.parentNode.removeChild(item);let fig=new Figure(act.sample.figure,"sample-c"+id,document.getElementById("sampleSlide"+id));setTimeout((function(){fig.display()}),100)}utils.mathRender()}},removeSample(){let item=document.getElementById("sampleLayer");item.parentNode.removeChild(item)},startSlideShow(){MM.removeSample(),MM.startTimers()},nextSlide:function(id){MM.onlineState&&(MM.userAnswers[MM.steps[id].step]=document.getElementById("userAnswer"+MM.steps[id].step).value);let step=MM.steps[id].nextStep();if(!1===step)return MM.timers[id].end(),!1;MM.timers[id].start(step);let slidetoHide=document.querySelector("#slide"+id+"-"+(step-1)),slide=document.querySelector("#slide"+id+"-"+step);utils.addClass(slidetoHide,"hidden"),slide&&(utils.removeClass(slide,"hidden"),void 0!==MM.figs[id+"-"+step]&&MM.figs[id+"-"+step].display(),MM.onlineState&&document.getElementById("userAnswer"+step).focus())},messageEndSlide:function(id,nth){let sliderMessage;document.querySelectorAll("#slider"+id+" .slide")[nth].innerHTML="<span>Fin du diaporama</span>"},endSliders:function(){let ended=!0;for(let i=0,l=MM.timers.length;i<l;i++)!1===MM.timers[i].ended&&(ended=!1);if(ended){if(MM.hideSlideshows(),MM.onlineState){let score=0,div=document.createElement("div"),ol=document.createElement("ol");ol.innerHTML="<b>Tes réponses</b>";let ia=0;for(let indexA=0,lenA=MM.carts[0].activities.length;indexA<lenA;indexA++)for(let indexQ=0,lenQ=MM.carts[0].activities[indexA].questions.length;indexQ<lenQ;indexQ++){let li=document.createElement("li"),span=document.createElement("span");const userAnswer=MM.userAnswers[ia],expectedAnswer=MM.carts[0].activities[indexA].values[indexQ];if(/[^-\d]/.test(userAnswer)||(span.className="math"),span.textContent=userAnswer,String(userAnswer)==String(expectedAnswer))li.className="good",score++;else{const expr1=KAS.parse(expectedAnswer).expr,expr2=KAS.parse(String(userAnswer).replace("²","^2")).expr;try{KAS.compare(expr1,expr2,{form:!0,simplify:!1}).equal?(li.className="good",score++):li.className="wrong"}catch(error){li.className="wrong"}}ia++,li.appendChild(span),ol.appendChild(li)}div.appendChild(ol);let section=document.createElement("section");section.innerHTML="<b>Score :</b> "+score+"/"+ia,div.appendChild(section),document.getElementById("corrige-content").appendChild(div)}1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())}},pauseAllSliders(){for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].pause()},stopAllSliders:function(){for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].end()},nextAllSliders:function(){for(let i=0,l=MM.steps.length;i<l;i++)MM.nextSlide(i)},setMinimalDisposition:function(index){let radios=document.querySelectorAll("input[name='Enonces']");for(let i=0,l=radios.length;i<l;i++)radios[i].disabled=i<index,i===index&&(radios[i].checked=!0,MM.setDispositionEnonce(index+1))},setDispositionEnonce:function(value){if(value=Number(value),MM.slidersNumber=value,1===value)document.getElementById("sddiv1").className="sddiv1",document.getElementById("sddiv2").className="hidden",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",document.getElementById("onlinechoice").className="",MM.setDispositionDoubleEnonce("h"),MM.carts[0].target=[1];else if(2===value){let directions;document.querySelectorAll("input[name='direction']")[0].checked?MM.setDispositionDoubleEnonce("h"):MM.setDispositionDoubleEnonce("v"),document.getElementById("sddiv1").className="sddiv2",document.getElementById("sddiv2").className="sddiv2",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("onlinechoice").className="hidden",value>MM.carts.length?MM.carts[0].target=[1,2]:(MM.carts[0].target=[1],MM.carts[1].target=[2])}else 3===value?(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34",document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("onlinechoice").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3])):4===value&&(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34",document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="sddiv34",document.getElementById("onlinechoice").className="hidden",document.querySelector("input[name='online'][value='no']").checked=!0,document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3,4]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3,4]):3===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3],MM.carts[2].target=[4]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3],MM.carts[3].target=[4]));for(let i=0,l=MM.carts.length;i<l;i++)MM.carts[i].display()},setDispositionDoubleEnonce:function(option){"h"===option?(MM.slidersOrientation="horizontal",document.getElementById("screen-division").className=""):(MM.slidersOrientation="vertical",document.getElementById("screen-division").className="vertical",document.querySelector("input[name='direction'][value='v']").checked=!0)}},library={open:function(json){let obj=new activity(json);MM.editedActivity=obj;var tab=document.querySelector("a[numero$='parameters'].tabs-menu-link");utils.resetAllTabs(),utils.addClass(tab,"is-active"),document.getElementById("tab-parameters").style.display="",document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",obj.display()},load:function(url){let reader=new XMLHttpRequest;reader.onload=function(){let json=JSON.parse(reader.responseText);utils.setHistory("Exercice",{u:url}),library.open(json)},reader.open("get","library/"+url,!1),reader.send()},import:function(objact,url,actparams,last=!1){let reader=new XMLHttpRequest;reader.onload=function(){let json=JSON.parse(reader.responseText),obj=objact;obj.setParams(json),obj.chosenOptions=actparams.o,obj.chosenQuestionTypes=actparams.p,obj.chosenQuestions=actparams.q,obj.tempo=actparams.t,obj.nbq=actparams.n},reader.open("get","library/"+url,!1),reader.send()},openContents:function(){let reader=new XMLHttpRequest;reader.onload=function(){MM.content=JSON.parse(reader.responseText),utils.createTuiles(),utils.checkURL()},reader.open("get","library/content.json",!0),reader.send()},displayContent:function(level,base=!1){if(void 0===MM.content)return console.log("Pas de bibliothèque"),!1;let niveau={nom:"Recherche",themes:{}};if(base)niveau=MM.content[level];else{if(level.length<3)return!1;for(let niv in MM.content)if("object"==typeof MM.content[niv])for(let theme in MM.content[niv].themes)for(let chap in MM.content[niv].themes[theme].chapitres){let chapExo=[];for(let exo=0,lene=MM.content[niv].themes[theme].chapitres[chap].e.length;exo<lene;exo++)if(MM.content[niv].themes[theme].chapitres[chap].e[exo].t.toLowerCase().indexOf(level.toLowerCase())>-1){let reg=new RegExp(level.toLowerCase(),"gi");chapExo.push({u:MM.content[niv].themes[theme].chapitres[chap].e[exo].u,t:MM.content[niv].themes[theme].chapitres[chap].e[exo].t.replace(reg,(function(x){return"<mark>"+x+"</mark>"}))})}chapExo.length>0&&(niveau.themes[theme]||(niveau.themes[theme]={nom:MM.content[niv].nom+"/"+MM.content[niv].themes[theme].nom,chapitres:{}}),niveau.themes[theme].chapitres[chap]={n:MM.content[niv].themes[theme].chapitres[chap].n,e:chapExo})}}let html="";html=base?"<h1>Niveau "+niveau.nom+" ("+niveau.activitiesNumber+" act.)</h1>":"<h1>Résultat de la recherche</h1>",utils.setHistory(niveau.nom,{n:level});for(let i in niveau.themes){let first=!0,theme=!1,htmlt=first?"<span>":"";htmlt+="<h2>"+niveau.themes[i].nom+"</h2>";for(let j in niveau.themes[i].chapitres){let chapitre=!1,htmlc=first?"":"<span>";if(htmlc+="<h3>"+niveau.themes[i].chapitres[j].n+"</h3>",htmlc+="<ul>",niveau.themes[i].chapitres[j].e.length){theme=!0,chapitre=!0;for(let k=0,len=niveau.themes[i].chapitres[j].e.length;k<len;k++)htmlc+="<li onclick=\"library.load('"+niveau.themes[i].chapitres[j].e[k].u+"')\">"+niveau.themes[i].chapitres[j].e[k].t+"</li>"}else htmlc+="<li>Pas encore d'exercice</li>";htmlc+="</ul>",chapitre&&(htmlt+=htmlc+(first?"":"</span>"),!0===first&&(htmlt+="</span>",first=!1))}theme&&(html+=htmlt)}document.getElementById("resultat-chercher").innerHTML=html,document.querySelector("#header-menu a[numero='#tab-chercher']").click()}};class activity{constructor(obj){_.isObject(obj)?this.setParams(obj):_.isString(obj)&&(this.id=obj)}setParams(obj){this.id=obj.id||obj.ID,this.type=obj.type,this.figure=obj.figure,this.title=obj.title,this.description=obj.description,this.vars=obj.vars,this.consts=obj.consts,this.options=utils.clone(obj.options)||void 0,this.questionPatterns=utils.clone(obj.questionPatterns)||obj.question,this.answerPatterns=utils.clone(obj.answerPatterns)||obj.answer,this.valuePatterns=utils.clone(obj.valuePatterns)||obj.value,this.questions=utils.clone(obj.questions)||[],this.answers=utils.clone(obj.answers)||[],this.samples=utils.clone(obj.samples)||[],this.values=utils.clone(obj.values)||[],this.figures=utils.clone(obj.figures)||[],this.examplesFigs={},this.chosenOptions=utils.clone(obj.chosenOptions)||[],this.chosenQuestions=utils.clone(obj.chosenQuestions)||{},this.chosenQuestionTypes=utils.clone(obj.chosenQuestionTypes)||[],this.tempo=utils.clone(obj.tempo)||Number(document.getElementById("tempo-slider").value),this.nbq=utils.clone(obj.nbq)||Number(document.getElementById("nbq-slider").value)}initialize(){this.questions=[],this.answers=[],this.values=[],this.figures=[],this.examplesFigs={}}setTempo(value){this.tempo=Number(value)}setNbq(value){this.nbq=Number(value)}export(){return{y:"a",i:this.id,o:this.chosenOptions,q:this.chosenQuestions,p:this.chosenQuestionTypes,t:this.tempo,n:this.nbq}}import(obj){let regexp,level,url="N"+/(\d*|T)/.exec(obj.i)[0]+"/"+obj.i+".json";library.import(this,url,obj)}getOption(){return 0===this.chosenOptions.length&&this.options?utils.aleaInt(0,this.options.length-1):this.chosenOptions.length>0&&this.chosenOptions[utils.aleaInt(0,this.chosenOptions.length-1)]}setMath(content){return void 0===this.type||"latex"===this.type?'<span class="math">'+content+"</span>":content}display(cle="sample"){this.initialize(),document.getElementById("param-title-act").innerHTML=this.id,document.getElementById("activityTitle").innerHTML=this.title,this.description?document.getElementById("activityDescription").innerHTML=this.description:document.getElementById("activityDescription").innerHTML="";var examples=document.getElementById("activityOptions");if(examples.innerHTML="",utils.setSeed(cle),void 0!==this.options&&this.options.length>0){let colors=[""," red"," orange"," blue"," green"," grey"],p=utils.create("span",{className:"bold"}),hr=utils.create("hr"),input=utils.create("input",{type:"checkbox",id:"checkalloptions",className:"checkbox blue"});input.setAttribute("onclick","MM.editedActivity.setOption('all',this.checked)"),p.appendChild(input),p.appendChild(document.createTextNode(" Tout (dé)sélectionner")),examples.appendChild(p),examples.appendChild(hr);for(let i=0;i<this.options.length;i++){this.generate(1,i,!1);let p=utils.create("span"),input=utils.create("input",{id:"o"+i,type:"checkbox",value:i,defaultChecked:this.chosenOptions.indexOf(i)>-1,className:"checkbox"+colors[i%colors.length]});input.setAttribute("onclick","MM.editedActivity.setOption(this.value, this.checked);"),p.appendChild(input),p.innerHTML+=" "+this.options[i].name+" :";let ul=document.createElement("ul");if(Array.isArray(this.questions[0]))for(let jj=0;jj<this.questions[0].length;jj++){let li=utils.create("li",{className:"tooltip"}),checked="";this.chosenQuestions[i]&&this.chosenQuestions[i].indexOf(jj)>-1&&(checked="checked"),li.innerHTML="<input class='checkbox"+colors[i%colors.length]+"' type='checkbox' id='o"+i+"-"+jj+"' value='"+i+"-"+jj+"' onclick='MM.editedActivity.setOption(this.value, this.checked);'"+checked+"> "+this.setMath(this.questions[0][jj]);let span=utils.create("span",{className:"tooltiptext"});Array.isArray(this.answers[0])?span.innerHTML=this.setMath(String(this.answers[0][jj]).replace(this.questions[0],this.questions[0][jj])):span.innerHTML=this.setMath(String(this.answers[0]).replace(this.questions[0],this.questions[0][jj])),li.appendChild(span),ul.appendChild(li)}else{let li=utils.create("li",{className:"tooltip",innerHTML:this.setMath(this.questions[0])});this.figures[0]&&(this.examplesFigs[i]=new Figure(utils.clone(this.figures[0]),"fig-ex"+i,li));let span=utils.create("span",{className:"tooltiptext",innerHTML:this.setMath(this.answers[0])});li.appendChild(span),ul.appendChild(li)}p.appendChild(ul),examples.appendChild(p)}}else{this.generate(1);let p=document.createElement("span"),ul=document.createElement("ul");if(Array.isArray(this.questions[0]))for(let jj=0;jj<this.questions[0].length;jj++){let li=document.createElement("li");li.className="tooltip",li.innerHTML="<input type='checkbox' class='checkbox' value='"+jj+"' onclick='MM.editedActivity.setQuestionType(this.value, this.checked);' ><span class='math'>"+this.questions[0][jj]+"</span>";let span=document.createElement("span");span.className="tooltiptext",Array.isArray(this.answers[0])?span.innerHTML=this.setMath(this.answers[0][jj].replace(this.questions[0],this.questions[0][jj])):span.innerHTML=this.setMath(this.answers[0].replace(this.questions[0],this.questions[0][jj])),li.appendChild(span),ul.appendChild(li)}else{let li=document.createElement("li");li.className="tooltip",li.innerHTML=this.setMath(this.questions[0]),this.figures[0]&&(this.examplesFigs[0]=new Figure(utils.clone(this.figures[0]),"fig-ex0",li));let span=document.createElement("span");span.className="tooltiptext",span.innerHTML=this.setMath(this.answers[0]),li.appendChild(span),ul.appendChild(li)}p.appendChild(ul),examples.appendChild(p)}utils.isEmpty(this.examplesFigs)||setTimeout((function(){for(let i in MM.editedActivity.examplesFigs)MM.editedActivity.examplesFigs[i].display()}),300),utils.mathRender()}getPattern(option){return this.chosenQuestionTypes.length>0?this.chosenQuestionTypes[utils.aleaInt(0,this.chosenQuestionTypes.length-1)]:!1!==option&&(Array.isArray(this.chosenQuestions[option])||(this.chosenQuestions[option]=[]),0===this.chosenQuestions[option].length&&Array.isArray(this.options[option].question)?utils.aleaInt(0,this.options[option].question.length-1):0===this.chosenQuestions[option].length&&!this.options[option].question&&Array.isArray(this.questionPatterns)?utils.aleaInt(0,this.questionPatterns.length-1):this.chosenQuestions[option].length>0&&this.chosenQuestions[option][utils.aleaInt(0,this.chosenQuestions[option].length-1)])}setOption(value,check){var optionId,renderId;if("all"===value){this.chosenOptions=[];for(let i=0,len=this.options.length;i<len;i++){this.chosenQuestions[i]=[];let lenq=0;if("object"==typeof this.options[i].question?lenq=this.options[i].question.length:"object"==typeof this.questionPatterns&&(lenq=this.questionPatterns.length),check){this.chosenOptions.push(i);for(let j=0;j<lenq;j++)this.chosenQuestions[i].push(j),document.getElementById("o"+i+"-"+j).checked=!0;document.getElementById("o"+i).checked=!0}else{for(let j=0;j<lenq;j++)document.getElementById("o"+i+"-"+j).checked=!1;document.getElementById("o"+i).checked=!1}}}else if(value.indexOf("-")>-1){let Ids=value.split("-");optionId=Number(Ids[0]),renderId=Number(Ids[1]),check?(document.getElementById("o"+optionId).checked=!0,this.chosenOptions.indexOf(optionId)<0&&this.chosenOptions.push(optionId),Array.isArray(this.chosenQuestions[optionId])?this.chosenQuestions[optionId].indexOf(renderId)<0&&this.chosenQuestions[optionId].push(renderId):this.chosenQuestions[optionId]=[renderId]):this.chosenQuestions[optionId].removeValue(renderId)&&0===this.chosenQuestions[optionId].length&&(this.chosenOptions.removeValue(optionId),document.getElementById("o"+optionId).checked=!1)}else if(optionId=Number(value),check){if(this.chosenOptions.indexOf(optionId)<0&&this.chosenOptions.push(optionId),this.chosenQuestions[optionId]=[],"object"==typeof this.options[optionId].question)for(let i=0;i<this.options[optionId].question.length;i++)this.chosenQuestions[optionId].push(i),document.getElementById("o"+optionId+"-"+i).checked=!0;else if(Array.isArray(this.questionPatterns))for(let i=0;i<this.questionPatterns.length;i++)this.chosenQuestions[optionId].push(i),document.getElementById("o"+optionId+"-"+i).checked=!0}else if(this.chosenOptions.removeValue(optionId))if("object"==typeof this.options[optionId].question){for(let i=0;i<this.options[optionId].question.length;i++)document.getElementById("o"+optionId+"-"+i).checked=!1;delete this.chosenQuestions[optionId]}else if(Array.isArray(this.questionPatterns)){for(let i=0;i<this.questionPatterns.length;i++)document.getElementById("o"+optionId+"-"+i).checked=!1;delete this.chosenQuestions[optionId]}}setQuestionType(value,check){let questionId=Number(value);check?this.chosenQuestionTypes.indexOf(questionId)<0&&this.chosenQuestionTypes.push(questionId):this.chosenQuestionTypes.removeValue(questionId)}replaceVars(chaine,questiontext){function onlyVarw(all,p1,p2,decal,chaine){return"this.wVars['"+p1+"']"+p2}function onlyVarc(all,p1,p2,decal,chaine){return"this.cConsts['"+p1+"']"+p2}if("string"==typeof chaine){for(const c in this.wVars){let regex=new RegExp(":("+c+")([^\\w\\d])","g");chaine=chaine.replace(regex,onlyVarw)}for(const c in this.cConsts){let regex=new RegExp(":("+c+")([^\\w\\d])","g");chaine=chaine.replace(regex,onlyVarc)}if(void 0!==questiontext){let regex=/:question/g;chaine=chaine.replace(regex,questiontext)}let result="";try{result=eval("`"+chaine.replace(/\\/g,"\\\\")+"`")}catch(error){debug(error,"Erreur avec "+chaine)}return isNaN(result)?result:parseFloat(result)}if("object"==typeof chaine){if(_.isArray(chaine))for(let i=0;i<chaine.length;++i)chaine[i]=this.replaceVars(chaine[i],questiontext);else for(const i in chaine)chaine[i]=this.replaceVars(chaine[i],questiontext);return chaine}return chaine}generate(n,opt,patt,sample){void 0===n&&(n=this.nbq);let optionNumber,patternNumber,lenQ=!1;this.wVars={},this.cFigure=void 0;let loopProtect=0,maxLoop=100;for(let i=0;i<n;i++){optionNumber=void 0===opt?this.getOption():opt,patternNumber=void 0===patt?this.getPattern(optionNumber):patt,!1!==optionNumber?(void 0===this.options[optionNumber].vars?this.cVars=this.vars:this.cVars=this.options[optionNumber].vars,void 0===this.options[optionNumber].consts?this.cConsts=this.consts:this.cConsts=this.options[optionNumber].consts,!1!==patternNumber?void 0!==this.options[optionNumber].question?(this.cQuestion=this.options[optionNumber].question[patternNumber],lenQ=this.options[optionNumber].question.length):(this.cQuestion=this.questionPatterns[patternNumber],lenQ=this.questionPatterns.length):void 0===this.options[optionNumber].question?this.cQuestion=this.questionPatterns:this.cQuestion=this.options[optionNumber].question,void 0===this.options[optionNumber].answer?this.cAnswer=this.answerPatterns:this.cAnswer=this.options[optionNumber].answer,void 0===this.options[optionNumber].value?this.cValue=this.valuePatterns:this.cValue=this.options[optionNumber].value,Array.isArray(this.cAnswer)&&lenQ&&(this.cAnswer.length===lenQ?this.cAnswer=this.cAnswer[patternNumber]:this.cAnswer=this.cAnswer[utils.aleaInt(0,this.cAnswer.length-1)],this.cValue.length===lenQ&&(this.cValue=this.cValue[patternNumber])),void 0!==this.options[optionNumber].figure?this.cFigure=utils.clone(this.options[optionNumber].figure):void 0!==this.figure&&(this.cFigure=utils.clone(this.figure))):(this.cVars=this.vars,this.cConsts=this.consts,this.cQuestion=!1!==patternNumber?this.questionPatterns[patternNumber]:this.questionPatterns,this.cAnswer=this.answerPatterns,this.cValue=this.valuePatterns,void 0!==this.figure&&(this.cFigure=utils.clone(this.figure)));for(const name in this.cVars)if(this.wVars[name]=this.cVars[name],"string"==typeof this.wVars[name]&&this.wVars[name].indexOf("${")>-1&&(this.wVars[name]=this.replaceVars(this.wVars[name])),"object"==typeof this.wVars[name])this.wVars[name]=this.replaceVars(this.wVars[name][utils.aleaInt(0,this.wVars[name].length-1)]);else if("string"==typeof this.wVars[name]&&this.wVars[name].indexOf("_")>-1){var bornes=this.wVars[name].split("_");bornes[0].indexOf("d")>-1?this.wVars[name]=utils.aleaFloat(Number(bornes[0].substring(1)),Number(bornes[1]),Number(bornes[2]),bornes[3],bornes[4]):this.wVars[name]=utils.aleaInt(Number(bornes[0]),Number(bornes[1]),bornes[2],bornes[3])}if(void 0!==this.cConsts&&(this.cConsts=this.replaceVars(this.cConsts)),sample)this.sample={question:this.replaceVars(this.cQuestion)},this.sample.answer=this.replaceVars(this.cAnswer,this.sample.question),void 0!==this.cFigure&&(this.sample.figure={type:this.cFigure.type,content:this.replaceVars(this.cFigure.content),boundingbox:this.cFigure.boundingbox,axis:this.cFigure.axis,grid:!!this.cFigure.grid});else{let thequestion=this.replaceVars(_.clone(this.cQuestion)),thevalue=this.replaceVars(_.clone(this.cValue));if(loopProtect++,!(this.questions.indexOf(thequestion)<0||this.values.indexOf(thevalue)<0)){if(i--,loopProtect<100)continue;debug("Pas assez de données pour éviter les répétitions");break}this.questions[i]=thequestion,this.answers[i]=this.replaceVars(_.clone(this.cAnswer),thequestion),this.values[i]=thevalue,void 0!==this.cFigure&&(this.figures[i]={type:this.cFigure.type,content:this.replaceVars(_.clone(this.cFigure.content)),boundingbox:this.cFigure.boundingbox,axis:this.cFigure.axis,grid:!!this.cFigure.grid})}}}generateSample(){let option=this.getOption();this.generate(1,option,this.getPattern(option),!0)}}