import utils from"./utils.min.js";import sound from"./sound.min.js";import cart from"./cart.min.js";import steps from"./steps.min.js";import Zoom from"./zoom.min.js";import Figure from"./figure.min.js";import timer from"./timer.min.js";import keyBoard from"./keyboard.min.js";import ficheToPrint from"./fichetoprint.min.js";import library from"./library.min.js";import draw from"./draw.min.js";import activity from"./activity.min.js";export{MM as default};const MM={version:7,content:void 0,introType:"321",endType:"nothing",touched:!1,selectedCart:0,seed:"",editedActivity:void 0,slidersOrientation:"",onlineState:"no",carts:[],steps:[],timers:[],figs:{},userAnswers:[[],[],[],[]],slidersNumber:1,faceToFace:"n",colorSelectors:[],colors:[],memory:[],goodAnswers:[],zooms:{},mf:{},text2speach:[],keyboards:{},ended:!0,embededIn:!1,setSeed(value){if(void 0!==value&&"sample"!==value&&"checkSwitched"!==value)MM.seed=value,document.getElementById("aleaKey").value=value;else if("sample"===value)MM.seed=utils.seedGenerator();else if(!0===document.getElementById("aleaInURL").checked)""===document.getElementById("aleaKey").value?(MM.seed=utils.seedGenerator(),document.getElementById("aleaKey").value=MM.seed):MM.seed=document.getElementById("aleaKey").value;else{if("checkSwitched"===value)return!1;MM.seed=utils.seedGenerator(),document.getElementById("aleaKey").value=MM.seed}MM.initializeAlea(MM.seed)},initializeAlea:function(seed){seed?(utils.alea&&delete utils.alea,utils.alea=new Math.seedrandom(seed)):(utils.alea&&delete utils.alea,utils.alea=new Math.seedrandom(MM.seed))},showTab:function(element){let tab,el;MM.resetAllTabs(),"none"!==element&&("string"==typeof element?(tab=element,el=document.querySelector("#header-menu a[numero='#"+element+"']")):(el=element,tab=element.getAttribute("numero").substr(1)),utils.addClass(el,"is-active"),document.getElementById(tab).style.display="")},showParameters:function(id){let ids=["paramsdiapo","paramsexos","paramsinterro","paramsceinture","paramsflashcards","paramswhogots","paramsdominos","paramscourse","paramsduel"];if(ids.indexOf(id)<0)return!1;for(let i=0,len=ids.length;i<len;i++)document.getElementById(ids[i]).className="hidden";document.getElementById(id).className=""},resetAllTabs:function(){MM.annotateThisThing(!1);let tabsButtons=document.querySelectorAll("#header-menu .tabs-menu-link"),contents=document.querySelectorAll(".tabs-content-item");document.getElementById("tab-accueil").display="none",contents.forEach(element=>{element.style.display="none"}),utils.removeClass(document.getElementById("btnaccueil"),"is-active"),tabsButtons.forEach(element=>{utils.removeClass(element,"is-active")})},closeMessage(id){let div=document.getElementById(id);div.parentNode.removeChild(div),document.body.removeEventListener("click",evt=>{"btn-messagefin-close"===evt.target.id&&(MM.closeMessage("messagefin"),MM.showTab("tab-corrige"))})},setEndType(value){this.endType=value},setAudio(value){this.slidersNumber>1?utils.checkRadio("audioRadio","0"):(this.editedActivity.audioRead=1==value,utils.checkRadio("audioRadio",value))},setAudioRepetitions(value){value=Number(value),this.editedActivity.audioRepeat=value,document.getElementById("audiorepeat").value=value},setIntroType(value){this.introType=value},setOnlineState(value){this.onlineState=value,document.querySelector("input[name='online'][value='"+value+"']").checked=!0},getOnlineState(){this.onlineState=utils.getRadioChecked("online")},editActivity:function(index){index=Number(index),MM.editedActivity=MM.carts[MM.selectedCart].activities[index],MM.setTempo(MM.editedActivity.tempo),MM.setNbq(MM.editedActivity.nbq),MM.setAudio(MM.editedActivity.audioRead),MM.setAudioRepetitions(MM.editedActivity.audioRepeat),MM.carts[MM.selectedCart].editedActivityId=index,MM.carts[MM.selectedCart].display(),MM.editedActivity.display(),document.getElementById("unlinkCart").className="",document.getElementById("addToCart").className="hidden",document.getElementById("removeFromCart").className=""},uneditActivity:function(){document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",document.getElementById("unlinkCart").className="hidden"},unlinkActivity:function(){this.uneditActivity(),MM.editedActivity=new activity(utils.clone(MM.editedActivity)),MM.editedActivity.display(),MM.carts[MM.selectedCart].editedActivityId=-1,MM.carts[MM.selectedCart].display()},setTempo:function(value){document.getElementById("tempo-slider").value=value,document.getElementById("tempo-value").innerHTML=value+" s."},setNbq:function(value){document.getElementById("nbq-slider").value=value,document.getElementById("nbq-value").innerHTML=value},changeTempoValue:function(value){document.getElementById("tempo-value").innerHTML=value+" s.",MM.editedActivity&&(MM.editedActivity.Tempo=value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+MM.selectedCart+"-list li.active span")[0].innerHTML=value)},changeNbqValue:function(value){document.getElementById("nbq-value").innerHTML=value,MM.editedActivity&&(MM.editedActivity.nombreQuestions=value),MM.carts[MM.selectedCart].editedActivityId>-1&&(document.querySelectorAll("#cart"+MM.selectedCart+"-list li.active span")[1].innerHTML=value)},checkValues:function(){MM.changeTempoValue(document.getElementById("tempo-slider").value),MM.changeNbqValue(document.getElementById("nbq-slider").value)},resetCarts:function(){let Cart=new cart(0);MM.carts=[Cart],MM.setMinimalDisposition(0),MM.steps=[],MM.timers=[],MM.figs={},MM.resetInterface()},resetInterface(){document.getElementById("divcarts").className="hidden",document.getElementById("phantom").className="",document.getElementById("divparams").className="col-2 row-3",utils.checkRadio("direction",this.slidersOrientation),utils.checkRadio("beforeSlider",this.introType),utils.checkRadio("endOfSlideRadio",this.endType),utils.checkRadio("online",this.onlineState),utils.checkRadio("facetoface",this.faceToFace),utils.checkRadio("Enonces",this.slidersNumber)},showCartInterface(){document.getElementById("divcarts").className="row-4",document.getElementById("phantom").className="hidden",document.getElementById("divparams").className="row-3"},addCart:function(){this.uneditActivity();let cartsNb=MM.carts.length+1;if(cartsNb>4)return!1;MM.carts[cartsNb-1]=new cart(cartsNb-1),MM.setMinimalDisposition(cartsNb-1);let button=utils.create("button");button.value=cartsNb,button.className="tabs-menu-link",button.innerHTML='<img src="img/cart'+cartsNb+'.png">',button.id="button-cart"+cartsNb;let addcart=document.getElementById("addcart"),cartsMenu=document.getElementById("cartsMenu"),lastButton=cartsMenu.removeChild(addcart);cartsMenu.appendChild(button).click(),cartsNb<4&&cartsMenu.appendChild(lastButton)},getCartsContent:function(){let div=utils.create("div",{style:"display:flex;"});for(let i=0;i<MM.carts.length;i++){let ul=utils.create("ul",{innerHTML:"<span class='bold'>"+MM.carts[i].title+"</span>"}),acts=MM.carts[i].activities;for(let j=0;j<acts.length;j++){let li=utils.create("li",{innerText:acts[j].title});ul.appendChild(li)}div.appendChild(ul)}return div},restoreCartsInterface:function(){let cartsMenu=document.getElementById("cartsMenu");cartsMenu.innerHTML='<button class="tabs-menu-link is-active" value="1" id="button-cart1"><img src="img/cart1.png"></button>\n        <button id="addcart" title="Ajouter un panier"><img src="img/cartadd.png"></button>';for(let i=1;i<this.carts.length;i++){let btnnb=i+1,button=utils.create("button",{value:btnnb,className:"tab-menu-link",innerHTML:'<img src="img/cart'+btnnb+'.png">',id:"button-cart"+btnnb}),addcart=document.getElementById("addcart"),lastButton=cartsMenu.removeChild(addcart);cartsMenu.appendChild(button),btnnb<4&&cartsMenu.appendChild(lastButton)}},removeCart:function(index){if(!window.confirm("Vous êtes sur le point de supprimer ce panier.\nConfirmez-vous ?"))return!1;let buttonCartToremove=document.getElementById("button-cart"+MM.carts.length),cartsMenu=document.getElementById("cartsMenu");if(cartsMenu.removeChild(buttonCartToremove),!document.getElementById("addcart")){let buttonAddCart=document.createElement("button");buttonAddCart.id="addcart",buttonAddCart.innerHTML='<img src="img/cartadd.png">',buttonAddCart.onclick=function(){MM.addCart()},cartsMenu.appendChild(buttonAddCart)}MM.carts.splice(index-1,1),MM.setMinimalDisposition(MM.carts.length-1),MM.showCart(1)},showCart(index){this.uneditActivity(),index=Number(index),MM.selectedCart=index-1;for(let i=1,nb=MM.carts.length,btn;i<=4;i++){i<=nb&&(btn=document.getElementById("button-cart"+i));let div=document.getElementById("cart"+(i-1));i!==index?(div.className="hidden",i<=nb&&utils.removeClass(btn,"is-active")):(div.className="cartcontent",i<=nb&&utils.addClass(btn,"is-active"))}MM.carts[MM.selectedCart].editedActivityId>-1&&(MM.carts[MM.selectedCart].activities[MM.carts[MM.selectedCart].editedActivityId].display(),this.editActivity(MM.carts[MM.selectedCart].editedActivityId))},emptyCart(index){if(!window.confirm("Vous êtes sur le point de vider ce panier.\nConfirmez-vous ?"))return!1;MM.carts[index-1].activities=[],MM.carts[index-1].editedActivityId=-1,MM.carts[index-1].display()},addToCart(){MM.carts[MM.selectedCart].addActivity(MM.editedActivity),MM.showCartInterface()},removeFromCart(id=!1){let cart=MM.carts[MM.selectedCart],idact=id||cart.editedActivityId;id&&Number(id)!=Number(cart.editedActivityId)||(cart.editedActivityId=-1,document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",document.getElementById("unlinkCart").className="hidden"),cart.removeActivity(idact)},checkLoadedCarts(start=!1){let loaded=!0;for(const panier of this.carts)panier.loaded||(loaded=!1);if(loaded)if(start)MM.start();else{const tabaccueil=document.getElementById("tab-accueil");let message='Tu as suivi un lien d\'activité préconfigurée MathsMentales.<br>Clique ci-dessous pour démarrer.<br><br><button class="button--primary" id="btn-message-start"> Démarrer le diaporama </button>';1===MM.carts.length&&null===sound.selected&&(message+='<br><br><button class="button--info" id="btn-message-sound">Avec du son</button>'),1===MM.carts.length&&1===MM.carts[0].target.length&&(message+='<br><br> ou <button class="button--success" id="btn-message-interact"> Commencer (interactif)</button>');let alert=utils.create("div",{id:"messageinfo",className:"message",innerHTML:message});tabaccueil.appendChild(alert),tabaccueil.addEventListener("click",evt=>{switch(evt.target.id){case"btn-message-start":MM.closeMessage("messageinfo"),MM.start();break;case"btn-message-sound":sound.next();break;case"btn-message-interact":MM.closeMessage("messageinfo"),MM.setOnlineState("yes"),MM.start()}})}else{let messageinfo=document.getElementById("messageinfo");null!==messageinfo&&(messageinfo.innerHTML+="<br><br>Le chargement n'est pas encore terminé. Patience...")}},populateQuestionsAndAnswers(withAnswer){void 0===withAnswer&&(withAnswer=!0),MM.figs={},MM.steps=[],MM.timers=[],MM.memory={},MM.goodAnswers=[],MM.text2speach=[];let length=MM.carts.length,enonces=document.getElementById("enonce-content"),corriges=document.getElementById("corrige-content");length>1&&(enonces.className="grid-"+length,corriges.className="grid-"+length),enonces.innerHTML="",corriges.innerHTML="",MM.setSeed(),MM.copyURLtoHistory();for(let i=0;i<length;i++){MM.carts[i].actsArrays=[];for(let kk=0,clen=MM.carts[i].target.length;kk<clen;kk++){let indiceSlide=0;MM.goodAnswers[kk]=[];let slideNumber=MM.carts[i].target[kk]-1,slider=document.getElementById("slider"+slideNumber);void 0!==MM.colors[slideNumber]&&(slider.style.background=MM.colors[slideNumber]);let addTitle="";clen>1&&(addTitle="-"+(kk+1));let titleSlider=MM.carts[i].title+addTitle;document.querySelector("#slider"+slideNumber+" .slider-title").innerHTML=titleSlider;let sliderSteps=document.querySelector("#slider"+slideNumber+" .steps-container"),dive=utils.create("div",{id:"de"+i+"-"+kk}),divc=utils.create("div",{id:"dc"+i+"-"+kk});MM.zooms["zc"+i+"-"+kk]=new Zoom("zc"+i+"-"+kk,"#dc"+i+"-"+kk+" ol",!0),MM.zooms["ze"+i+"-"+kk]=new Zoom("ze"+i+"-"+kk,"#de"+i+"-"+kk+" ol",!0),dive.appendChild(MM.zooms["ze"+i+"-"+kk].createCursor()),divc.appendChild(MM.zooms["zc"+i+"-"+kk].createCursor());let h3e=utils.create("h3",{innerText:titleSlider}),h3c=utils.create("h3",{innerText:titleSlider});dive.append(h3e),divc.append(h3c);let ole=utils.create("ol"),olc=utils.create("ol");void 0!==MM.colors[slideNumber]&&(ole.style.background=MM.colors[slideNumber],olc.style.background=MM.colors[slideNumber]),MM.steps[slideNumber]=new steps({size:0,container:sliderSteps}),MM.timers[slideNumber]=new timer(slideNumber);let actsArray=[];for(let z=0,alen=MM.carts[i].activities.length;z<alen;z++){let activity=MM.carts[i].activities[z];activity.generate(),MM.goodAnswers[kk][z]=utils.clone(activity.values),MM.steps[slideNumber].addSize(activity.nbq);for(let j=0;j<activity.questions.length;j++)actsArray.push([z,j])}MM.carts[i].ordered||(actsArray=utils.shuffle(actsArray)),MM.carts[i].actsArrays[kk]=actsArray;for(let ff=0;ff<actsArray.length;ff++){let activity=MM.carts[i].activities[actsArray[ff][0]],j=actsArray[ff][1],question=activity.questions[j],answer=activity.answers[j],fontSize=activity.textSize||!1,color=ff%2?" pair":" impair",div=utils.create("div",{className:"slide w3-animate-top"+(indiceSlide>0?" hidden":"")+color,id:"slide"+slideNumber+"-"+indiceSlide}),span=utils.create("span",{innerHTML:question});fontSize&&(span.className=fontSize);let spanAns=utils.create("span",{className:"answerInSlide hidden"});Array.isArray(answer)?spanAns.innerHTML=answer[0]:spanAns.innerHTML=answer,fontSize&&(spanAns.className+=" "+fontSize),MM.timers[slideNumber].addDuration(activity.tempo);let lie=utils.create("li"),lic=document.createElement("li"),tex=!1,spane,spanc;void 0===activity.type||""===activity.type||"latex"===activity.type?(tex=!0,spane=utils.create("span",{className:"math",innerHTML:question}),lie.appendChild(spane),spanc=utils.create("span",{className:"math"}),lic.appendChild(spanc),span.className+=" math",spanAns.className+=" math"):lie.innerHTML=question,div.appendChild(span),"yes"!==MM.onlineState&&div.appendChild(spanAns),activity.audioRead&&void 0!==activity.audios[j]&&!1!==activity.audios[j]&&(MM.text2speach[indiceSlide]=[activity.audios[j],activity.audioRepeat]),slider.appendChild(div),Array.isArray(answer)?tex?spanc.innerHTML+=answer[0]:lic.innerHTML+=answer[0]:tex?spanc.innerHTML+=answer:lic.innerHTML+=answer,void 0!==activity.figures[j]&&(lic.innerHTML+='&nbsp; <button data-id="c'+slideNumber+"-"+indiceSlide+'">Figure</button>',MM.figs[slideNumber+"-"+indiceSlide]=new Figure(utils.clone(activity.figures[j]),"c"+slideNumber+"-"+indiceSlide,div),MM.memory["e"+slideNumber+"-"+indiceSlide]=new Figure(utils.clone(activity.figures[j]),"en"+slideNumber+"-"+indiceSlide,lie,[300,150]),MM.memory["c"+slideNumber+"-"+indiceSlide]=new Figure(utils.clone(activity.figures[j]),"cor"+slideNumber+"-"+indiceSlide,lic,[450,225])),ole.appendChild(lie),olc.appendChild(lic),indiceSlide++}dive.append(ole),divc.append(olc),enonces.append(dive),corriges.append(divc),MM.steps[slideNumber].display(),utils.isEmpty(MM.figs)||setTimeout((function(){for(let j=0;j<indiceSlide;j++)void 0!==MM.memory["e"+slideNumber+"-"+j]&&MM.memory["e"+slideNumber+"-"+j].display()}))}}utils.mathRender()},createUserInputs:function(){MM.mf={},MM.keyboards={};for(let slider=0,len=MM.carts[0].target.length;slider<len;slider++)for(let slide=0,len2=MM.carts[0].actsArrays[slider].length;slide<len2;slide++){const MFTARGET=document.getElementById("slider"+slider),element=document.getElementById("slide"+slider+"-"+slide),ID="ansInput"+slider+"-"+slide;MM.mf[ID]=new MathfieldElement({smartMode:!0,virtualKeyboardMode:"off",fontsDirectory:"../katex/fonts"});let keys=MM.carts[0].activities[MM.carts[0].actsArrays[slider][slide][0]].keyBoards[slide]||void 0;MM.keyboards[ID]=new keyBoard(MM.mf[ID],keys,element,slider),void 0!==MM.figs[slider+"-"+slide]&&(MM.mf[ID].style.fontSize="0.333em"),MM.mf[ID].id=ID,MM.mf[ID].target=element,MM.mf[ID].addEventListener("keyup",(function(event){"Enter"!==event.key&&"NumpadEnter"!==event.code||(MM.nextSlide(slider),event.preventDefault())})),element.appendChild(MM.mf[ID]),element.appendChild(utils.create("div",{style:"height:270px;"}))}},setFacetoFace(etat){this.faceToFace=etat,"y"===etat?(utils.addClass(document.getElementById("sddiv1"),"return"),MM.slidersNumber>2&&utils.addClass(document.getElementById("sddiv2"),"return")):(utils.removeClass(document.getElementById("sddiv1"),"return"),utils.removeClass(document.getElementById("sddiv2"),"return"))},getFacetoFace(){this.faceToFace=utils.getRadioChecked("facetoface")},createExercicesSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let withSeed=!1;document.getElementById("aleaInURL").checked&&(withSeed=!0);let params=this.paramsToURL(withSeed,"exosheet"),value=this.setURL(params,"exosheet");MM.window=window.open(value,"mywindow","location=no,menubar=no,titlebar=no,width=1123")},createCourseAuxNombres:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let withSeed=!1;document.getElementById("aleaInURL").checked&&(withSeed=!0);let params=this.paramsToURL(withSeed,"cansheet"),value=this.setURL(params,"cansheet");MM.window=window.open(value,"mywindow","location=no,menubar=no,titlebar=no,width=1123")},createExamSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("exam",MM.carts[0])},createCeintureSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let nbq=0;for(let i=0;i<MM.carts[0].activities.length;i++)nbq+=Number(MM.carts[0].activities[i].nbq);let nbqc=Number(document.getElementById("ceintcolsval").value)*Number(document.getElementById("ceintrowsval").value);if(nbq<nbqc)return void alert("Pas assez de questions dans le panier pour alimenter la ceinture\nde "+document.getElementById("ceintcolsval").value+"×"+document.getElementById("ceintrowsval").value+"="+nbqc+" emplacements");if(nbq>nbqc&&!confirm("Vous allez créé une ceinture de "+nbqc+" emplacements\nalors que vous avez créé un panier de"+nbq+"questions.\nToutes ne seront donc pas imprimées. Continuer ?"))return;let withSeed=!1;document.getElementById("aleaInURL").checked&&(withSeed=!0);let params=this.paramsToURL(withSeed,"ceinture"),value=this.setURL(params,"ceinture");MM.window=window.open(value,"mywindow","location=no,menubar=no,titlebar=no,width=1123")},createFlashCards:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("flashcard",MM.carts[0])},createWhoGots:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("whogots",MM.carts[0])},createDominos:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let withSeed=!1;document.getElementById("aleaInURL").checked&&(withSeed=!0);let params=this.paramsToURL(withSeed,"dominossheet"),value=this.setURL(params,"dominossheet");MM.window=window.open(value,"mywindow","location=no,menubar=no,titlebar=no,width=1123")},duelLaunch:function(){if(!MM.editedActivity)return;MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let withSeed=!1,params=this.paramsToURL(!1,"duel"),value=this.setURL(params,"duel");MM.window=window.open(value,"mywindow","location=no,menubar=no,titlebar=no,width=720")},start:function(){if(MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.getOnlineState(),"yes"===MM.onlineState){if(MM.userAnswers=[[],[],[],[]],MM.carts.length>1)for(let i=1,len=MM.carts.length;i<len;i++)delete MM.carts[i];document.querySelector("#slideshow-container > header").className="hidden"}else document.querySelector("#slideshow-container > header").className="";MM.showTab("none"),MM.checkIntro(),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),"321"===MM.introType?(document.getElementById("countdown-container").className="",sound.selected&&(setTimeout(()=>{sound.beeps()},800),setTimeout(()=>{sound.setSound(sound.selected)},3500)),setTimeout((function(){document.getElementById("countdown-container").className="hidden","yes"===MM.onlineState&&MM.createUserInputs(),MM.showSlideShows(),MM.startTimers()}),3600)):"example"===MM.introType?(MM.showSampleQuestion(),MM.showSlideShows()):("yes"===MM.onlineState&&MM.createUserInputs(),MM.showSlideShows(),MM.startTimers()),this.ended=!1},paramsToURL(withAleaSeed=!1,type=""){let colors=MM.colors.join("~").replace(/\,/g,"_");if("exosheet"===type)return"s="+document.getElementById("exTxtSizeValue").value+",n="+document.getElementById("exQtyValue").value+",cor="+utils.getRadioChecked("excorr")+",a="+(withAleaSeed?MM.seed:"")+",t="+encodeURI(document.getElementById("extitle").value||document.getElementById("extitle").placeholder)+",ex="+encodeURI(document.getElementById("exeachex").value||document.getElementById("exeachex").placeholder)+this.export();if("cansheet"===type)return"n="+document.getElementById("canqtyvalue").value+",t="+encodeURI(document.getElementById("cantitle").value||document.getElementById("cantitle").placeholder)+",a="+(withAleaSeed?MM.seed:"")+",cor="+(utils.getRadioChecked("cancorrpos")||"fin")+",tm="+(document.getElementById("cantime").value||document.getElementById("cantime").placeholder)+",t1="+encodeURI(document.getElementById("cancol1title").value||document.getElementById("cancol1title").placeholder)+",t2="+encodeURI(document.getElementById("cancol2title").value||document.getElementById("cancol2title").placeholder)+",t3="+encodeURI(document.getElementById("cancol3title").value||document.getElementById("cancol3title").placeholder)+this.export();if("dominossheet"===type)return"n="+document.getElementById("dominosNbValue").value+",a="+(withAleaSeed?MM.seed:"")+",d="+document.getElementById("dominosDoublons").checked+this.export();if("duel"===type)return"ty="+utils.getRadioChecked("dueltype")+",bg="+document.getElementById("duelbackgroundselect").value+("limit"===utils.getRadioChecked("dueltemps")?",t="+utils.timeToSeconds(document.getElementById("dueltotaltime").value):"")+this.export();if("ceinture"===type){let chaine="",t=0,titles;return document.querySelectorAll("#ceintcolumnTitle input").forEach(inp=>{chaine+=",t"+t+"="+(inp.value?utils.superEncodeURI(inp.value):""),t++}),"t="+utils.superEncodeURI(document.getElementById("ceinttitle").value)+",ke="+document.getElementById("ceintprintToEnonce").checked+",kc="+document.getElementById("ceintprintToCorrige").checked+",nc="+document.getElementById("ceintcolsval").value+chaine+",a="+(withAleaSeed?MM.seed:"")+",nr="+document.getElementById("ceintrowsval").value+",n="+document.getElementById("ceintqtyvalue").value+",cor="+(utils.getRadioChecked("ceintcorrpos")||"fin")+",pie="+document.getElementById("ceintpiedcol").value+",or="+(utils.getRadioChecked("ceintorientation")||"portrait")+this.export()}return"i="+MM.introType+",e="+MM.endType+",o="+MM.onlineState+",s="+MM.slidersNumber+",so="+MM.slidersOrientation+",f="+MM.faceToFace+",a="+(withAleaSeed?MM.seed:"")+",colors="+colors+",snd="+sound.selected+this.export()},setHistory(pageName,params){let url=MM.setURL(params);history.pushState({id:"Homepage"},pageName,url)},checkURL(urlString=!1,start=!0,edit=!1){const vars=utils.getUrlVars(urlString);if(vars.cor&&vars.ex&&location.href.indexOf("exercices.html")<0&&!edit){let url=new URL(location.href);location.href=url.origin+url.pathname.replace("index.html","")+"exercices.html"+url.search}if(void 0!==vars.embed){let expression,regex=new RegExp(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/gi);vars.embed.match(regex)&&(MM.embededIn=vars.embed)}if(void 0===vars.n||void 0!==vars.cd||edit)if(void 0===vars.u||void 0!==vars.cd||edit){if(void 0!==vars.c){let alert=utils.create("div",{id:"messageinfo",className:"message",innerHTML:"Chargement de l'activité MathsMentales.<br>Merci pour la visite."});if(document.getElementById("tab-accueil").appendChild(alert),"yes"!==vars.o||edit)setTimeout(()=>{MM.closeMessage("messageinfo")},3e3);else{start=!1,alert.innerHTML+="<br><br>";let button=utils.create("button",{innerHTML:"Commencer !"});button.onclick=()=>{MM.closeMessage("messageinfo"),MM.checkLoadedCarts(!0)},alert.appendChild(button)}if(MM.introType=vars.i,MM.endType=vars.e,"string"==typeof vars.colors){let couleurs=vars.colors.split("~");for(let i=0;i<couleurs.length;i++)MM.colors[i]=couleurs[i].replace(/_/g,","),document.getElementById("sddiv"+(i+1)).style.background=MM.colors[i]}vars.o&&(MM.onlineState=vars.o),vars.f&&(MM.faceToFace=vars.f),vars.s&&(MM.slidersNumber=Number(vars.s)),void 0!==vars.snd&&"null"!==vars.snd&&sound.setSound(Number(vars.snd)),(vars.a&&"no"===MM.onlineState||edit)&&(MM.setSeed(vars.a),document.getElementById("aleaInURL").checked=!0),MM.resetCarts(),vars.so&&(MM.slidersOrientation=vars.so);let json=vars.c;"string"==typeof vars.c&&(json=JSON.parse(decodeURIComponent(vars.c)));let allcarts=[];for(const i in json)MM.carts[i]=new cart(i),allcarts.push(MM.carts[i].import(json[i],start));Promise.all(allcarts).then(data=>{if(MM.resetInterface(),MM.restoreCartsInterface(),MM.showCartInterface(),MM.showCart(1),MM.editActivity(0),edit){if(MM.showTab("tab-parameters"),"paramsceinture"===utils.getTypeOfURL(urlString)){document.getElementById("ceinttitle").value=vars.t?decodeURIComponent(vars.t):"",document.getElementById("ceintcols").value=vars.nc,document.getElementById("ceintcolsval").value=vars.nc;let coltitles=document.getElementById("ceintcolumnTitle");coltitles.innerHTML="";for(let i=0,tot=Number(vars.nc);i<tot;i++)i>0&&coltitles.appendChild(utils.create("br")),coltitles.appendChild(utils.create("label",{for:"ceinttitlecol"+(i+1),innerHTML:"Colonne "+(i+1)+" :"})),coltitles.appendChild(utils.create("input",{type:"text",id:"ceinttitlecol"+(i+1),value:vars["t"+i]?decodeURIComponent(vars["t"+i]):""}));document.getElementById("ceintrows").value=vars.nr,document.getElementById("ceintrowsval").value=vars.nr,document.getElementById("ceintqty").value=vars.n,document.getElementById("ceintqtyvalue").value=vars.n,utils.checkRadio("ceintcorrpos",vars.cor),document.getElementById("ceintpiedcol").value=vars.pie,utils.checkRadio("ceintorientation",vars.o?vars.o:"portrait")}let element;utils.selectOption("chooseParamType",utils.getTypeOfURL(urlString)),document.getElementById("chooseParamType").dispatchEvent(new Event("change",{bubbles:!0}))}}).catch(err=>{let alert=utils.create("div",{id:"messageerreur",className:"message",innerHTML:"Impossible de charger les paniers :(<br>"+err});document.getElementById("tab-accueil").appendChild(alert),setTimeout(()=>{let div=document.getElementById("messageerreur");div.parentNode.removeChild(div)},3e3)})}else if(void 0!==vars.cd||void 0!==vars.panier){let alert=utils.create("div",{className:"message",innerHTML:"Ceci est le nouveau MathsMentales, les anciennes adresses ne sont malheureusement plus compatibles.<hr class='center w50'>Vous allez être redirigé vers l'ancienne version de MathsMentales dans 6 s. <a href='javascript:utils.goToOldVersion();'>Go !</a>"});document.getElementById("tab-accueil").appendChild(alert),setTimeout(utils.goToOldVersion,6e3)}}else{let regexp=/(\d+|T|G|K)/;if(_.isArray(vars.u)){let listeURLs=[];for(let i=0;i<vars.u.length;i++){let url=vars.u[i],level=regexp.exec(url)[0];listeURLs.push({u:"N"+level+"/"+url+".json",t:""})}library.displayContent(listeURLs)}else if(void 0!==vars.u){let level=regexp.exec(vars.u)[0];library.load("N"+level+"/"+vars.u+".json",vars.u)}else{let alert=utils.create("div",{className:"message",innerHTML:"Cette activité n'a pas de correspondance dans cette nouvelle version de MathsMentales.<hr class='center w50'>Vous allez être redirigé vers l'ancienne version dans 10s. <a>Go !</a>"});alert.onclick=utils.goToOldVersion(),document.getElementById("tab-accueil").appendChild(alert),setTimeout(utils.goToOldVersion,1e4)}}else library.displayContent(vars.n,!0)},copyURL(type=""){const colparams=document.getElementById("colparameters");let modalMessage=utils.create("div",{id:"urlCopy",className:"message",style:"padding:1.5rem",innerHTML:'<div>Adresse longue<div>\n                <textarea readonly="true" id="bigurl" cols="38" onfocus=""></textarea><br>\n                <button id="btn-urlshorter">Raccourcir l\'url</button><br>\n                <input readonly="true" type="url" id="shorturl" size="38">\n                <div id="shortQRdiv"></div>\n                '});colparams.addEventListener("click",evt=>{"btn-urlshorter"===evt.target.id&&MM.getQR()}),colparams.addEventListener("focus",evt=>{["bigurl","shorturl"].indexOf(evt.target.id)>-1&&utils.copy(evt.target)});let withSeed=!1;document.getElementById("aleaInURL").checked&&(withSeed=!0);let params=this.paramsToURL(withSeed,type),close=utils.create("button",{innerHTML:"<img src='img/closebutton32.png'>",style:"position:absolute;top:0.5rem;right:0.5rem;padding:0;background:transparent"});close.onclick=()=>{let m=document.getElementById("urlCopy");m.parentNode.removeChild(m)},modalMessage.appendChild(close),colparams.appendChild(modalMessage);let input=document.getElementById("bigurl");input.value=this.setURL(params,type),navigator.clipboard.writeText(input.value),input.select(),input.setSelectionRange(0,99999)},copyURLtoHistory(type=""){const contener=document.querySelector("#tab-historique ol");let withSeed=!0,params=this.paramsToURL(!0,type),url=this.setURL(params,type),paramsSansSeed=this.paramsToURL(!1,type),urlSansSeed=this.setURL(paramsSansSeed,type),li=utils.create("li"),typeName="Panier";"cansheet"===type?typeName="🏃‍♀️ Course aux nombres":"exosheet"===type?typeName="📖 Fiche d'exercices":"duel"===type?typeName="💫 Duel":"ceinture"===type&&(typeName="🥋 Ceinture");let span=utils.create("span",{innerText:typeName+" du "+utils.getDate()+": ",className:"bold"});li.appendChild(span);const a=utils.create("a",{href:url,innerText:"🎯 lien (mêmes données)"});li.appendChild(a);const a2=utils.create("a",{href:urlSansSeed,innerText:"🎯 lien (autres données)"});li.appendChild(a2);let button=`\n        <span class="pointer underline" data-url="${url}">🛠 éditer</span>\n        <span class="pointer underline">❌ Supprimer</span>\n        `;li.innerHTML+=button,li.appendChild(this.getCartsContent());try{let lis=document.querySelectorAll("#tab-historique span[data-url='"+url+"']");for(let k=0;k<lis.length;k++){let parent=lis[k].parentNode;contener.removeChild(parent)}}catch(err){console.log(err)}contener.prepend(li),window.localStorage&&localStorage.setItem("history",contener.innerHTML)},removeFromHistory(elem){if(!confirm("Supprimer cet élément : \n"+elem.childNodes[0].innerText+" ?"))return!1;document.querySelector("#tab-historique ol").removeChild(elem),window.localStorage&&localStorage.setItem("history",document.querySelector("#tab-historique ol").innerHTML)},removeSelectionFromHistory(){const CHECKED=document.querySelectorAll("#tab-historique input[class='checkhistoric']:checked");for(let i=CHECKED.length-1;i>=0;i--){let parent=CHECKED[i].parentNode;parent.parentNode.removeChild(parent)}window.localStorage&&(this.createSelectHistory(),localStorage.setItem("history",document.querySelector("#tab-historique ol").innerHTML),this.createSelectHistory())},createSelectHistory(){if(this.historySelectCreated)this.destroySelectHistory(),document.getElementById("actionsSelectHist").className="hidden";else{this.historySelectCreated=!0;const LISTE=document.querySelectorAll("#tab-historique > ol > li");for(let i=0;i<LISTE.length;i++){let input=utils.create("input",{type:"checkbox",value:i,selected:!1,className:"checkhistoric"});LISTE[i].prepend(input)}document.getElementById("actionsSelectHist").className=""}},destroySelectHistory(){this.historySelectCreated=!1;const LISTE=document.querySelectorAll("#tab-historique > ol > li > input");for(let i=0;i<LISTE.length;i++)LISTE[i].parentNode.removeChild(LISTE[i])},emptyHistory(){if(!confirm("Confirmez-vous la suppression de tout l'historique ?"))return!1;document.querySelector("#tab-historique ol").innerHTML="",window.localStorage&&localStorage.setItem("history","")},generatePage(){window.alert("Fonctionalité en cours de développement.")},generateCode(){window.alert("Fonctionnalité en cours de développement")},getQR(){MM.carts.length<2&&MM.carts[0].activities.length<2&&(MM.carts[0].activities=[],MM.carts[0].addActivity(MM.editedActivity));let url=document.getElementById("bigurl").value,alert=document.getElementById("shortQRdiv");alert.innerHTML="";let div=utils.create("div",{className:"lds-ellipsis",innerHTML:"<div></div><div></div><div></div><div></div>"}),div2=utils.create("div",{innerHTML:"Génération en cours"});alert.appendChild(div),alert.appendChild(div2);let shorter=new XMLHttpRequest;shorter.onload=function(){alert.removeChild(div),alert.removeChild(div2);let shorturl=shorter.responseText;if(0!==shorturl.indexOf("http:"))return void alert.appendChild(utils.create("h2",{innertext:"Problème de récupération de l'url courte"}));alert.appendChild(utils.create("h2",{innerText:"QRcode de l'exercice"}));let qrdest=utils.create("img",{id:"qrious",title:"Clic droit pour copier l'image"});alert.appendChild(qrdest);let inputShortUrl=document.getElementById("shorturl");inputShortUrl.value=shorturl,inputShortUrl.select(),inputShortUrl.setSelectionRange(0,99999),document.execCommand("copy");let QR=new QRious({element:qrdest,value:shorturl,size:200,padding:12})},shorter.open("get","getshort.php?url="+encodeURIComponent(url)),shorter.send()},annotateThisThing:function(target,btnId){!1===target&&void 0!==MM.annotate?(MM.annotate.destroy(),MM.annotate=void 0):void 0===MM.annotate&&_.isString(target)?MM.annotate=new draw(target,btnId):void 0!==MM.annotate&&(MM.annotate.destroy(),MM.annotate=void 0)},createTuiles(){let grille;const ordre=library.ordre;function setContent(id,obj){const elt=utils.create("article",{className:"tuile",title:"Cliquer pour afficher toutes les activités du niveau"}),titre=utils.create("h3",{innerHTML:obj.nom});elt.appendChild(titre);const nba=utils.create("div",{innerHTML:obj.activitiesNumber+" activités"});elt.onclick=()=>{library.displayContent(id,!0)},elt.appendChild(nba),grille.appendChild(elt)}for(const o in ordre){grille=document.getElementById(o);for(let i=0;i<ordre[o].length;i++)void 0!==MM.content[ordre[o][i]].activitiesNumber&&0!==MM.content[ordre[o][i]].activitiesNumber&&"activitiesNumber"!==i&&setContent(ordre[o][i],MM.content[ordre[o][i]])}},createSearchCheckboxes(){let dest=document.getElementById("searchLevels");const ordre=library.ordre;for(const o in ordre)for(let i=0;i<ordre[o].length;i++){if(void 0===MM.content[ordre[o][i]].activitiesNumber||0===MM.content[ordre[o][i]].activitiesNumber||"activitiesNumber"===i)continue;const div=utils.create("div"),input=utils.create("input",{type:"checkbox",name:"searchlevel",value:ordre[o][i],className:"checkbox",id:"ccbs"+ordre[o][i]});input.onclick=()=>{library.displayContent(document.getElementById("searchinput").value)};const label=utils.create("label",{for:"ccbs"+ordre[o][i],innerText:MM.content[ordre[o][i]].nom});label.onclick=evt=>{document.getElementById(evt.target.for).click()},div.appendChild(input),div.appendChild(label),dest.appendChild(div)}},export(){let urlString="";MM.carts[0].activities.length<2&&1===MM.carts.length&&(MM.carts[0].activities=[],MM.carts[0].addActivity(MM.editedActivity)),MM.checkIntro();for(let i=0;i<this.carts.length;i++)urlString+=this.carts[i].export();return urlString},setURL:(string,type)=>"exosheet"===type?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","exercices")+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:"")):"cansheet"===type?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","courseauxnombres")+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:"")):"dominossheet"===type?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","dominos")+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:"")):"duel"===type?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","duel")+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:"")):"ceinture"===type?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","ceinture")+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:"")):utils.baseURL+"?"+string+(MM.embededIn?"&embed="+MM.embededIn:""),checkIntro:function(){MM.introType=utils.getRadioChecked("beforeSlider"),MM.endType=utils.getRadioChecked("endOfSlideRadio")},startTimers:function(){void 0!==MM.text2speach[0]&&MM.speech.speak(MM.text2speach[0]),"yes"!==MM.onlineState||MM.touched||document.getElementById("ansInput0-0").focus();for(let i=0,k=MM.timers.length;i<k;i++)MM.timers[i].start(0)},showSampleQuestion:function(){let nb=MM.slidersNumber;MM.setSeed("sample");let container=document.getElementById("slideshow"),assocSliderActivity=[];for(let i=0,len=MM.carts.length;i<len;i++){MM.carts[i].activities[0].generateSample();for(let j=0;j<MM.carts[i].target.length;j++)assocSliderActivity[MM.carts[i].target[j]-1]=i}let divSample=utils.create("div",{id:"sampleLayer",className:"sample"});for(let i=0;i<nb;i++){let div=utils.create("div",{id:"sample"+i});div.className=1===nb?"slider-1":2===nb?"slider-2":"slider-34";let nextActivity="";MM.carts[assocSliderActivity[i]].activities.length>1&&(nextActivity=`<button title="Activité suivante du panier" data-actid="0" id="ButtonNextAct${i}"><img src="img/slider-next.png"></button>`),div.innerHTML=`Exemple <div class="slider-nav">\n            <button title="Annoter l'exemple" id="btn-sample-annotate${i}"><img src="img/iconfinder_pencil_1055013.png"></button>\n            <button title="Montrer la réponse" id="btn-sample-showanswer${i}"><img src="img/slider-solution.png"></button>\n            <button title="Autre exemple" id="btn-newsample${i}"><img src="img/newsample.png"></button>\n            ${nextActivity}\n            <button title="Démarrer le diaporama" id="btn-sample-start${i}"><img src="img/fusee.png"></button>\n            </div>`;let divContent=utils.create("div",{className:"slide",id:"sampleSlide"+i}),span=utils.create("span",{id:"sample"+i+"-enonce"}),spanAnswer=utils.create("span",{id:"sample"+i+"-corr",className:"hidden"});divContent.appendChild(span),divContent.appendChild(spanAnswer),div.appendChild(divContent),divSample.appendChild(div)}container.appendChild(divSample);for(let i=0;i<MM.carts.length;i++)for(let y=0;y<MM.carts[i].target.length;y++){let sN=MM.carts[i].target[y]-1,act=MM.carts[i].activities[0];if(document.getElementById("sample"+sN+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+sN+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+sN+"-enonce").className="math",document.getElementById("sample"+sN+"-corr").className+=" math"),void 0!==act.sample.figure){let fig=new Figure(utils.clone(act.sample.figure),"sample-c"+sN,document.getElementById("sampleSlide"+sN));setTimeout((function(){fig.display()}),100)}}utils.mathRender()},showQuestions:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),MM.showTab(document.querySelector("[numero='#tab-enonce'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},showAnswers:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),MM.showTab(document.querySelector("[numero='#tab-corrige'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},createSlideShows:function(){MM.zooms={},MM.zooms.thezoom=new Zoom("thezoom","#slideshow .slide",!0);let insertTo=document.querySelector("#slideshow-container header"),ispresent=insertTo.querySelector("#thezoom");if(ispresent&&insertTo.removeChild(ispresent),insertTo.appendChild(MM.zooms.thezoom.createCursor()),isNaN(MM.slidersNumber)){let nb=0;for(let i=0;i<MM.carts.length;i++)nb+=MM.carts[i].target.length;nb<5&&(MM.slidersNumber=nb)}let nb=MM.slidersNumber,container=document.getElementById("slideshow");container.innerHTML="","v"===MM.slidersOrientation?utils.addClass(container,"vertical"):utils.removeClass(container,"vertical"),"y"===MM.faceToFace?utils.addClass(container,"return"):utils.removeClass(container,"return");for(let i=0;i<nb;i++){let facteurZoom=1,div=document.createElement("div");div.id="slider"+i,1===nb?(div.className="slider-1",facteurZoom=3):2===nb?(div.className="slider-2",facteurZoom=2):div.className="slider-34";let innerH=`<div class="slider-head"><div class="slider-nav">\n            <button title="Arrêter le diaporama" id="btn-timer-end${i}"><img src="img/slider-stop.png" /></button>`;"no"===MM.onlineState&&(innerH+=`<button title="Mettre le diapo en pause", id="btn-timer-pause${i}"><img src="img/slider-pause.png" /></button>\n                <button title="Montrer la réponse" id="btn-show-answer${i}"><img src="img/slider-solution.png" /></button>`),MM.zooms["zs"+i]=new Zoom("zs"+i,"#slider"+i+" .slide",!1,"em",facteurZoom);let zoom=MM.zooms["zs"+i].createCursor();innerH+=`<button title="Passer la diapo" id="btn-next-slide${i}"><img src="img/slider-next.png" /></button>\n            </div>\n            <div class="slider-title"></div>\n            <div class="slider-chrono"><progress class="progress is-link is-large" value="0" max="100"></progress></div></div>\n            <div class="steps-container"></div>`,div.innerHTML=innerH,div.querySelector(".slider-head").appendChild(zoom),container.appendChild(div)}},showSlideShows:function(){utils.removeClass(document.getElementById("slideshow-container"),"hidden"),utils.addClass(document.getElementById("app-container"),"hidden"),sound.selected&&sound.play(),utils.isEmpty(MM.figs)||MM.displayFirstFigs()},displayFirstFigs:function(){for(let i=0;i<4;i++)"object"==typeof MM.figs[i+"-0"]&&MM.figs[i+"-0"].display()},hideSlideshows:function(){if(this.ended)return!1;utils.addClass(document.getElementById("slideshow-container"),"hidden"),utils.removeClass(document.getElementById("app-container"),"hidden");let whatToDo=utils.getRadioChecked("endOfSlideRadio");if("yes"===MM.onlineState){let alert=utils.create("div",{id:"messagefin",className:"message",innerHTML:'L\'activité MathsMentales est terminée.<br>Pour consulter les résultats, cliquer sur le bouton ci-dessous.<br><br>\n            <button id="btn-messagefin-close"> Voir le corrigé \n            </button>'});document.body.appendChild(alert),document.body.addEventListener("click",evt=>{"btn-messagefin-close"===evt.target.id&&(MM.closeMessage("messagefin"),MM.showTab("tab-corrige"))})}else"correction"===whatToDo?MM.showTab("tab-corrige"):"list"===whatToDo&&MM.showTab("tab-enonce");this.ended=!0},showTheAnswer(id){let answerToShow=document.querySelector("#slide"+id+"-"+MM.steps[id].step+" .answerInSlide");answerToShow&&(answerToShow.className.indexOf("hidden")>-1?(MM.timers[id].pause(),utils.removeClass(answerToShow,"hidden")):(utils.addClass(answerToShow,"hidden"),MM.timers[id].start()))},showSampleAnswer(id){let answerToShow=document.getElementById("sample"+id+"-corr");answerToShow.className.indexOf("hidden")>-1?utils.removeClass(answerToShow,"hidden"):utils.addClass(answerToShow,"hidden")},newSample(id,next=!1){for(let i=0,len=MM.carts.length;i<len;i++)if(MM.carts[i].target.indexOf(id+1)>-1){let nbActivities=MM.carts[i].activities.length,actId=0;MM.carts[i].activities.length>1&&(actId=document.getElementById("ButtonNextAct"+id).dataset.actid,next&&(actId++,actId>=nbActivities&&(actId=0),document.getElementById("ButtonNextAct"+id).dataset.actid=actId));let act=MM.carts[i].activities[actId];if(act.generateSample(),document.getElementById("sample"+id+"-enonce").innerHTML=act.sample.question,document.getElementById("sample"+id+"-corr").innerHTML=act.sample.answer,void 0!==act.type&&""!==act.type&&"latex"!==act.type||(document.getElementById("sample"+id+"-enonce").className="math",document.getElementById("sample"+id+"-corr").className+=" math"),void 0!==act.sample.figure){let item;item="chart"===act.sample.figure.type?document.getElementById("div-dest-canvas-sample-c"+id):document.getElementById("sample-c"+id),item.parentNode.removeChild(item);let fig=new Figure(utils.clone(act.sample.figure),"sample-c"+id,document.getElementById("sampleSlide"+id));setTimeout((function(){fig.display()}),100)}utils.mathRender()}},removeSample(){let item=document.getElementById("sampleLayer");item.parentNode.removeChild(item)},startSlideShow(){MM.removeSample(),"yes"===MM.onlineState&&MM.createUserInputs(),"yes"!==MM.onlineState||MM.touched||document.getElementById("ansInput0-0").focus(),MM.startTimers()},nextSlide:function(id){"yes"===MM.onlineState&&(MM.userAnswers[id][MM.steps[id].step]=MM.mf["ansInput"+id+"-"+MM.steps[id].step].value);let step=MM.steps[id].nextStep();if(!1===step)return MM.timers[id].end(),!1;1===MM.carts.length&&sound.play(),MM.timers[id].start(step);let slidetoHide=document.querySelector("#slide"+id+"-"+(step-1)),slide=document.querySelector("#slide"+id+"-"+step);utils.addClass(slidetoHide,"hidden"),slide&&(utils.removeClass(slide,"hidden"),void 0!==MM.figs[id+"-"+step]&&MM.figs[id+"-"+step].display(),"yes"!==MM.onlineState||MM.touched?"yes"===MM.onlineState&&MM.touched&&MM.mf["ansInput"+id+"-"+step].focus():MM.mf["ansInput"+id+"-"+step].focus(),void 0!==MM.text2speach[step]&&MM.speech.speak(MM.text2speach[step]))},messageEndSlide:function(id,nth){let sliderMessage;document.querySelectorAll("#slider"+id+" .slide")[nth].innerHTML="<span>Fin du diaporama</span>"},endSliders:function(){MM.text2speach.length&&MM.speech.stop();let ended=!0;for(let i=0,l=MM.timers.length;i<l;i++)!1===MM.timers[i].ended&&(ended=!1);if(ended){if(MM.hideSlideshows(),"yes"===MM.onlineState){let div=document.createElement("div");for(let slider=0,len=MM.carts[0].actsArrays.length;slider<len;slider++){let score=0,ol=document.createElement("ol");ol.innerHTML="<b>Réponses de "+(slider+1)+"</b>";let ia=0;for(let slide=0,len2=MM.carts[0].actsArrays[slider].length;slide<len2;slide++){let refs=MM.carts[0].actsArrays[slider][slide],li=document.createElement("li"),span=document.createElement("span"),userAnswer=MM.userAnswers[slider][ia].replace(",",".").trim();0===userAnswer.indexOf("\\text")&&(userAnswer=userAnswer.substring(6,userAnswer.length-1)),userAnswer=userAnswer.replace("\\text{ }"," "),userAnswer=userAnswer.replace(">","\\gt"),userAnswer=userAnswer.replace("<","\\lt");const expectedAnswer=MM.goodAnswers[slider][refs[0]][refs[1]];let valueType=MM.carts[0].activities[refs[0]].valueType;if(Array.isArray(expectedAnswer))for(let i=0;i<expectedAnswer.length;i++){if(String(userAnswer).toLowerCase()==String(expectedAnswer[i]).toLowerCase()){li.className="good",score++;break}{const expr1=KAS.parse(expectedAnswer[i]).expr,expr2=KAS.parse(String(userAnswer).replace("²","^2")).expr;try{if(KAS.compare(expr1,expr2,{form:!0,simplify:!1}).equal){li.className="good",score++;break}li.className="wrong"}catch(error){li.className="wrong"}}}else if(!1!==valueType){if("liste"===valueType){let arrayUser=userAnswer.split(";").map(value=>value.trim()).sort((a,b)=>a-b),arrayExpected=expectedAnswer.split(";").map(value=>value.trim()).sort((a,b)=>a-b);arrayUser.toString()===arrayExpected.toString()?(li.className="good",score++):li.className="wrong"}else if("inInterval"===valueType){let minmax=expectedAnswer.split("-").map(value=>Number(value));Number(userAnswer)>minmax[0]&&Number(userAnswer)<minmax[1]?(li.className="good",score++):li.className="wrong"}}else if(String(userAnswer).toLowerCase()==String(expectedAnswer).toLowerCase())li.className="good",score++;else{const expr1=KAS.parse(expectedAnswer).expr,expr2=KAS.parse(String(userAnswer).replace("²","^2")).expr;try{KAS.compare(expr1,expr2,{form:!0,simplify:!1}).equal?(li.className="good",score++):li.className="wrong"}catch(error){li.className="wrong"}}span.className="math",userAnswer="\\displaystyle "+userAnswer,span.textContent=userAnswer,ia++,li.appendChild(span),ol.appendChild(li)}div.appendChild(ol);let section=document.createElement("section");section.innerHTML="<b>Score :</b> "+score+"/"+ia,div.appendChild(section),MM.embededIn&&window.parent.postMessage({url:window.location.href,graine:MM.seed,nbBonnesReponses:score,nbMauvaisesReponses:parseInt(ia)-parseInt(score),slider:slider,touchable:MM.touched},MM.embededIn)}document.getElementById("corrige-content").appendChild(div),utils.mathRender()}else MM.embededIn&&window.parent.postMessage({url:window.location.href,graine:MM.seed},MM.embededIn);1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.showCart(1),MM.editActivity(0))}},pauseAllSliders(){if("no"===MM.onlineState)for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].pause()},stopAllSliders:function(){for(let i=0,l=MM.timers.length;i<l;i++)MM.timers[i].end();MM.text2speach.length&&MM.speech.stop()},nextAllSliders:function(){for(let i=0,l=MM.steps.length;i<l;i++)MM.nextSlide(i)},setMinimalDisposition:function(index){let radios=document.querySelectorAll("input[name='Enonces']");for(let i=0,l=radios.length;i<l;i++)radios[i].disabled=i<index,i===index&&MM.slidersNumber<=index+1&&(radios[i].checked=!0,MM.setDispositionEnonce(index+1))},setDispositionEnonce:function(value){if(value=Number(value),MM.slidersNumber=value,document.getElementById("facetofaceOption").className="",value>1&&MM.setAudio(0),1===value)document.getElementById("sddiv1").className="sddiv1",document.getElementById("sddiv2").className="hidden",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),MM.carts[0].target=[1],document.getElementById("facetofaceOption").className="hidden";else if(2===value){let directions;document.querySelectorAll("input[name='direction']")[0].checked?MM.setDispositionDoubleEnonce("h"):MM.setDispositionDoubleEnonce("v"),"y"===MM.faceToFace?document.getElementById("sddiv1").className="sddiv2 return":document.getElementById("sddiv1").className="sddiv2",document.getElementById("sddiv2").className="sddiv2",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="",value>MM.carts.length?MM.carts[0].target=[1,2]:(MM.carts[0].target=[1],MM.carts[1].target=[2])}else 3===value?("y"===MM.faceToFace?(document.getElementById("sddiv1").className="sddiv34 return",document.getElementById("sddiv2").className="sddiv34 return"):(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34"),document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3])):4===value&&("y"===MM.faceToFace?(document.getElementById("sddiv1").className="sddiv34 return",document.getElementById("sddiv2").className="sddiv34 return"):(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34"),document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="sddiv34",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3,4]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3,4]):3===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3],MM.carts[2].target=[4]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3],MM.carts[3].target=[4]));for(let i=0,l=MM.carts.length;i<l;i++)MM.carts[i].display()},setDispositionDoubleEnonce:function(option){"h"===option?(MM.slidersOrientation="h",document.getElementById("screen-division").className="",document.querySelector("input[name='direction'][value='h']").checked=!0):(MM.slidersOrientation="v",document.getElementById("screen-division").className="vertical",document.querySelector("input[name='direction'][value='v']").checked=!0)}};