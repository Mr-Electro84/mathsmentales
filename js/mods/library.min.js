import utils from"./utils.min.js";import content from"./content.js";import MM from"./MM.min.js";import activity from"./activity.min.js";export{library as default};const library={ordre:{"grille-ecole":["11","10","9","8","7"],"grille-college":["6","5","4","3"],"grille-lycee":["2","G","K","T"]},open:function(json){let obj=new activity(json);MM.editedActivity=obj;let tab=document.querySelector("a[numero$='parameters'].tabs-menu-link");MM.resetAllTabs(),utils.addClass(tab,"is-active"),document.getElementById("tab-parameters").style.display="",document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",obj.display()},load:function(url,id){fetch("library/"+url+"?v"+MM.version).then(r=>r.json()).then(body=>{let regexp;url=/\/(.*)\./.exec(url)[1],MM.setHistory("Exercice","u="+url),this.open(body)}).catch(e=>console.log)},loadJSON:async function(url){const r=await fetch("library/"+url+"?v"+MM.version);if(!0===r.ok)return r.json();throw new Error("Erreur de chargement de l'activité")},import:async function(url){const r=await fetch("library/"+url+"?v"+MM.version);if(!0===r.ok)return r.json();throw new Error("Problème de chargement de l'activité")},openContents:function(){MM.content=content,MM.createTuiles(),MM.createSearchCheckboxes(),MM.checkURL(),MM.embededIn&&window.parent.postMessage({url:window.location.href,ready:"ok"},MM.embededIn)},displayContent:function(level,base=!1){let now=(new Date).getTime();if(void 0===MM.content)return console.log("Pas de bibliothèque"),!1;let niveau={nom:"Recherche",themes:{}};if(_.isObject(level)){niveau.nom="Cette activité a été répartie en plusieurs";for(let exo in level){let found=!1;for(let niv in MM.content){if(found)break;if(_.isObject(MM.content[niv]))for(let theme in MM.content[niv].themes){if(found)break;for(let chap in MM.content[niv].themes[theme].chapitres){if(found)break;if(MM.content[niv].themes[theme].chapitres[chap].e.length>0){if(found)break;for(let i=0;i<MM.content[niv].themes[theme].chapitres[chap].e.length;i++)if(MM.content[niv].themes[theme].chapitres[chap].e[i].u===level[exo].u){level[exo].t=MM.content[niv].themes[theme].chapitres[chap].e[i].t,found=!0;break}}}}}}niveau.themes[0]={nom:"Cliquer pour ouvrir une activité",chapitres:{MM1:{n:"Cliquer sur Rechercher pour revenir ici",e:level}}}}else if(base)niveau=MM.content[level];else{if(level.length<3)return!1;const levels=document.querySelectorAll("#searchLevels input[name='searchlevel']:checked"),selectedLevels=[];levels.forEach(elt=>{selectedLevels.push(elt.value)});let chaineATrouver=level.toLowerCase().split(" ");for(let niv in MM.content)if(!(selectedLevels.length>0&&selectedLevels.indexOf(niv)<0)&&_.isObject(MM.content[niv]))for(let theme in MM.content[niv].themes)for(let chap in MM.content[niv].themes[theme].chapitres){let chapExo=[];for(let exo=0,lene=MM.content[niv].themes[theme].chapitres[chap].e.length;exo<lene;exo++){let lexo=MM.content[niv].themes[theme].chapitres[chap].e[exo],tt=lexo.t;chaineATrouver.every(txt=>lexo.t.toLowerCase().indexOf(txt)>-1)?(chaineATrouver.forEach(txt=>{let reg=new RegExp(txt,"gi");tt=tt.replace(reg,(function(x){return"<mark>"+x+"</mark>"}))}),chapExo.push({u:lexo.u,t:tt,id:lexo.id})):chaineATrouver.every(txt=>lexo.u.toLowerCase().indexOf(txt+".")>-1)?chapExo.push({u:lexo.u,t:lexo.t,id:lexo.id}):void 0!==lexo.d&&chaineATrouver.every(txt=>lexo.d.toLowerCase().indexOf(txt)>-1)&&chapExo.push({u:lexo.u,t:lexo.t,id:lexo.id})}chapExo.length>0&&(niveau.themes[theme]||(niveau.themes[theme]={nom:MM.content[niv].nom+"/"+MM.content[niv].themes[theme].nom,chapitres:{}}),niveau.themes[theme].chapitres[chap]={n:MM.content[niv].themes[theme].chapitres[chap].n,e:chapExo})}}const eltAffichage=document.getElementById("resultat-chercher");let html="";base||_.isObject(level)?_.isObject(level)?html="<h2>Cette activité MathsMentales v1 a été répartie en plusieurs activités</h2>":(html="<h1 class='pointer moins' onclick='utils.deploy(this)'>Niveau "+niveau.nom+" ("+niveau.activitiesNumber+" act.)</h1>",document.getElementById("searchinput").value=""):html="<h1 class='pointer moins' onclick='utils.deploy(this)'>Résultat de la recherche</h1>",base&&!_.isObject(level)&&MM.setHistory(niveau.nom,"n="+level);let itemsNumber=0;for(let i in niveau.themes){let theme=!1,htmlt="";htmlt+="<h2 class='pointer moins' id='rch2"+i+"'>"+niveau.themes[i].nom+"</h2>";for(let j in niveau.themes[i].chapitres){let chapitre=!1,htmlc="";htmlc+="<h3 id='rch3"+i+"-"+j+"' class='pointer moins'>"+niveau.themes[i].chapitres[j].n+"</h3>",htmlc+="<ul>";let nbexos=niveau.themes[i].chapitres[j].e.length;if(nbexos){itemsNumber+=nbexos,theme=!0,chapitre=!0;for(let k=0,len=nbexos;k<len;k++){let id=niveau.themes[i].chapitres[j].e[k].id,title=niveau.themes[i].chapitres[j].e[k].t,url=niveau.themes[i].chapitres[j].e[k].u;niveau.themes[i].chapitres[j].e[k].new?htmlc+="<li id='rcli"+i+"-"+j+"-"+k+"' class='new tooltip' data-id='"+id+"' data-url='"+url+"'>"+title+"<input type='checkbox' class='checkitem' value='"+id+"' data-url='"+url+"'><div class='tooltiptext'>"+id+"</div></li>":htmlc+="<li id='rcli"+i+"-"+j+"-"+k+"' class='tooltip' data-id='"+id+"' data-url='"+url+"'>"+title+"<input type='checkbox' class='checkitem' value='"+id+"' data-url='"+url+"'><div class='tooltiptext'>"+id+"</div></li>"}}else htmlc+="<li>Pas encore d'exercice</li>";htmlc+="</ul>",chapitre&&(htmlt+=htmlc)}theme&&(html+=htmlt)}eltAffichage.innerHTML=html;let target=document.getElementById("tab-chercher");target.className="tabs-content-item",itemsNumber>40&&utils.pageWidth()>1e3?utils.addClass(target,"cols3"):itemsNumber>20&&utils.pageWidth()>840&&utils.addClass(target,"cols2"),document.querySelector("#header-menu a[numero='#tab-chercher']").click()}};