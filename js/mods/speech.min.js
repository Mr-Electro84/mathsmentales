import utils from"./utils.min.js";export default class speech{constructor(lang="fr-FR"){this.exists=this.test(),this.lang=lang,this.text="",this.times=1,this.timeout=!1,this.voices=!1,this.initialize()}test(){return"speechSynthesis"in window}initialize(){this.exists&&(this.voices=speechSynthesis.getVoices())}generateSelectOptions(selectDOMObj){return this.initialize(),this.voices.forEach((val,i)=>{let name;if(val.name.toLowerCase().indexOf("french")>-1||val.lang.indexOf("fr")>-1){let option=utils.create("option",{innerHTML:val.name,value:i});selectDOMObj.appendChild(option)}}),this.voices.length}speak(text=this.text,stop=!0){if(!this.exists)return;Array.isArray(text)?(this.times=text[1],this.text=text[0]):this.text=text;let msg=new SpeechSynthesisUtterance;return msg.voice=this.voice,msg.text=this.text,speechSynthesis.speaking&&stop&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=!1),speechSynthesis.cancel()),speechSynthesis.speak(msg),msg.onend=()=>{this.times--,this.times>0&&(this.timeout=setTimeout(()=>{speechSynthesis.speak(msg)},1500))},!1}setVoice(id){if((id=Number(id))>this.voices.length-1)return!1;this.voice=this.voices[id]}setText(text){this.text=text.replace("-"," moins "),this.text=this.text.replace(")/(",")sur(")}stop(){speechSynthesis.speaking&&(clearTimeout(this.timeout),this.timeout=!1,speechSynthesis.cancel())}}