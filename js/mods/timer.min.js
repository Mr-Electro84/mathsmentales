import MM from"./MM.min.js";import utils from"./utils.min.js";export default class timer{constructor(slideid,cartId){this.durations=[],this.durationId=0,this.startTime=0,this.endTime=0,this.timeLeft=0,this.percent=0,this.id=slideid,this.cartId=cartId,this.answerShowTime=0,this.answerShown=!1,this.break=!1,this.timer=!1,this.ended=!1}getTimeLeft(){this.timeLeft=this.endTime-Date.now(),this.percent=Math.max(Math.round(100-this.timeLeft/10/this.durations[this.durationId]),0),this.display(),this.timeLeft<=0&&("thenanswer"!==MM.carts[this.cartId].progress?(this.stop(),MM.nextSlide(this.id)):(this.answerShown||(MM.showTheAnswer(this.id,!1),this.answerShown=!0),this.timeLeft<=-this.answerShowTime&&(this.stop(),MM.nextSlide(this.id))))}addDuration(value){this.durations.push(value)}start(id){if(this.stop(),this.ended)return!1;this.break=!1;const btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];"no"===MM.onlineState&&(btnPause.src="img/slider-pause.png",utils.removeClass(btnPause,"blink_me")),id>-1&&(this.timeLeft=1e3*this.durations[id],this.durationId=id,this.answerShown=!1,this.answerShowTime=1e3*MM.carts[this.cartId].showAnswerTime),this.startTime=Date.now(),this.endTime=this.startTime+this.timeLeft,this.timer&&(clearInterval(this.timer),this.timer=!1),0!=this.durations[id]?this.timer=setInterval(this.getTimeLeft.bind(this),50):document.querySelector("#btn-timer-pause"+this.id).classList.add("hidden")}pause(){if(this.ended)return!1;if(this.break)return this.break=!1,this.start(),!1;{this.break=!0,this.stop();let btnPause=document.querySelectorAll("#slider"+this.id+" .slider-nav img")[1];btnPause.src="img/slider-play.png",utils.addClass(btnPause,"blink_me")}}stop(){this.timer&&(clearInterval(this.timer),this.timer=!1)}end(){this.stop(),this.ended=!0,MM.messageEndSlide(this.id,this.durationId),setTimeout(MM.endSliders,3e3)}display(){document.querySelector("#slider"+this.id+" progress").value=this.percent}}