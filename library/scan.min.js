const fs=require("fs"),path=require("path"),listOfActivities={},{off:off}=require("process"),getAllFiles=function(dirPath,arrayOfFiles){let files=fs.readdirSync(dirPath);return arrayOfFiles=arrayOfFiles||[],files.forEach((function(file){fs.statSync(dirPath+"/"+file).isDirectory()?arrayOfFiles=getAllFiles(dirPath+"/"+file,arrayOfFiles):arrayOfFiles.push([file,path.join(__dirname,dirPath,"/",file),fs.statSync(dirPath+"/"+file).mtime])})),arrayOfFiles},structure=JSON.parse(fs.readFileSync("./structure.json"));structure.activitiesNumber=0;for(let niveau in structure){structure[niveau].activitiesNumber=0;for(let theme in structure[niveau].themes)for(let chapter in structure[niveau].themes[theme].chapitres)structure[niveau].themes[theme].chapitres[chapter]={n:structure[niveau].themes[theme].chapitres[chapter],e:[]}}for(const niveau in structure){let now=(new Date).getTime()-2592e6,listOfFiles;"activitiesNumber"!==niveau&&getAllFiles("./N"+niveau).forEach((function(fichierExo){let nouveau=!1,dt;new Date(fichierExo[2]).getTime()>now&&(nouveau=!0,console.log(fichierExo[0]));let json=JSON.parse(fs.readFileSync(fichierExo[1]));listOfActivities[json.ID]=json;let exo={u:"N"+niveau+"/"+fichierExo[0],t:json.title+(json.speech?" ðŸ“£":""),new:nouveau,id:json.ID};json.ID+".json"!==fichierExo[0]&&console.error("Erreur de code pour "+fichierExo[0]),void 0!==json.description&&(exo.d=json.description),structure.activitiesNumber++;for(let i in json.dest){let codechap=json.dest[i],destLevel=codechap.match(/(^\d+|T|G|K)/i)[0],themecode=codechap.match(/^(\d+|T|G|K)[A-Z]/i)[0];void 0!==structure[destLevel]&&(structure[destLevel].activitiesNumber++,structure[destLevel].themes[themecode].chapitres[codechap].e.push(exo))}}))}for(const niveau in structure)for(const them in structure[niveau].themes)for(const chap in structure[niveau].themes[them].chapitres)structure[niveau].themes[them].chapitres[chap].e.length&&structure[niveau].themes[them].chapitres[chap].e.sort((a,b)=>{let fa=a.t.toLowerCase(),fb=b.t.toLowerCase();return fa<fb?-1:fa>fb?1:0});let dataActivities=JSON.stringify(listOfActivities);fs.writeFileSync("../js/mods/theactivities.js","export {theactivities as default};const theactivities="+dataActivities);let data=JSON.stringify(structure);fs.writeFileSync("../js/mods/content.js","export {content as default};const content="+data);